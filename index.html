<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìˆ˜í•™ í€´ì¦ˆ ì•±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 40px;
            max-width: 600px;
            width: 100%;
            text-align: center;
        }

        .title {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .menu {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }

        .menu button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .menu button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .quiz-section {
            display: none;
        }

        .quiz-section.active {
            display: block;
        }

        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .name-suggestions {
            position: relative;
        }

        .suggestions-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #ddd;
            border-top: none;
            border-radius: 0 0 10px 10px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .suggestion-item {
            padding: 10px 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
            transition: background-color 0.2s;
        }

        .suggestion-item:hover {
            background-color: #f5f5f5;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-name {
            flex: 1;
        }

        .suggestion-grade {
            font-size: 0.8em;
            color: #666;
            margin-left: 10px;
        }

        .delete-btn {
            background: #ff4757;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }

        .delete-btn:hover {
            background: #ff3742;
        }

        .grade-display {
            font-size: 0.9em;
            color: #667eea;
            font-weight: 500;
            margin-top: 5px;
        }

        .question-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .question {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #333;
        }

        .choices {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .choice-btn {
            background: white;
            border: 2px solid #ddd;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1em;
        }

        .choice-btn:hover {
            border-color: #667eea;
            background: #f0f2ff;
        }

        .choice-btn.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .choice-btn.correct {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        .choice-btn.wrong {
            background: #f44336;
            color: white;
            border-color: #f44336;
        }

        .result {
            background: #e8f5e8;
            border: 2px solid #4CAF50;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            display: none;
        }

        .result.show {
            display: block;
        }

        .explanation-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            display: none;
        }

        .explanation-section.show {
            display: block;
        }

        .explanation-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .explanation-title::before {
            content: "ğŸ’¡";
            margin-right: 8px;
        }

        .wrong-answer-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .wrong-answer-question {
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }

        .wrong-answer-details {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
        }

        .explanation-content {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 12px;
            border-radius: 0 8px 8px 0;
            margin-top: 10px;
        }

        .explanation-step {
            margin: 8px 0;
            padding-left: 15px;
            position: relative;
        }

        .explanation-step::before {
            content: "âœ“";
            position: absolute;
            left: 0;
            color: #4caf50;
            font-weight: bold;
        }

        .tip-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 12px;
            margin-top: 10px;
            font-size: 0.9em;
        }

        .tip-box::before {
            content: "ğŸ’¡ íŒ: ";
            font-weight: bold;
            color: #856404;
        }

        .score {
            font-size: 2em;
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 10px;
        }

        .records {
            text-align: left;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .record-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .back-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            margin-top: 20px;
        }

        .back-btn:hover {
            background: #5a6268;
        }

        .center-back-btn {
            background: linear-gradient(45deg, #6c757d, #5a6268);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(108, 117, 125, 0.3);
            margin: 30px auto;
            display: block;
        }

        .center-back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(108, 117, 125, 0.4);
        }

        .next-btn {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
            margin-left: auto;
            margin-top: 20px;
        }

        .next-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.4);
        }

        .quiz-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }

        .setup-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            gap: 20px;
        }

        .start-quiz-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
            flex: 1;
            max-width: 200px;
        }

        .start-quiz-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .progress {
            background: #e0e0e0;
            border-radius: 10px;
            height: 20px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-bar {
            background: linear-gradient(45deg, #667eea, #764ba2);
            height: 100%;
            transition: width 0.3s ease;
        }
        
        .question-image {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e9ecef;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5em;
            font-family: monospace;
            white-space: pre;
            line-height: 1.2;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">ğŸ¯ ìˆ˜í•™ í€´ì¦ˆ ì•±</h1>
        
        <div id="mainMenu" class="menu">
            <button onclick="startQuiz()">ğŸ® í€´ì¦ˆ ì‹œì‘</button>
            <button onclick="showRecords()">ğŸ“‹ ê¸°ë¡ ë³´ê¸°</button>
        </div>

        <div id="quizSetup" class="quiz-section">
            <h2>í€´ì¦ˆ ì„¤ì •</h2>
            <div class="input-group">
                <label for="userName">ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:</label>
                <div class="name-suggestions">
                    <input type="text" id="userName" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" autocomplete="off">
                    <div class="suggestions-dropdown" id="suggestionsDropdown"></div>
                </div>
            </div>
            <div class="input-group">
                <label for="grade">í•™ë…„ì„ ì„ íƒí•˜ì„¸ìš”:</label>
                <select id="grade" onchange="updateGradeDisplay()">
                    <optgroup label="ì´ˆë“±í•™êµ">
                        <option value="1">1í•™ë…„</option>
                        <option value="2">2í•™ë…„</option>
                        <option value="3" selected>3í•™ë…„</option>
                        <option value="4">4í•™ë…„</option>
                        <option value="5">5í•™ë…„</option>
                        <option value="6">6í•™ë…„</option>
                    </optgroup>
                    <optgroup label="ì¤‘í•™êµ">
                        <option value="7">1í•™ë…„</option>
                        <option value="8">2í•™ë…„</option>
                        <option value="9">3í•™ë…„</option>
                    </optgroup>
                    <optgroup label="ê³ ë“±í•™êµ">
                        <option value="10">1í•™ë…„</option>
                        <option value="11">2í•™ë…„</option>
                        <option value="12">3í•™ë…„</option>
                    </optgroup>
                </select>
                <div class="grade-display" id="gradeDisplay"></div>
            </div>
            <div class="input-group">
                <label for="difficulty">ë‚œì´ë„ë¥¼ ì„ íƒí•˜ì„¸ìš”:</label>
                <select id="difficulty">
                    <option value="ì‰¬ì›€">ì‰¬ì›€ (ë°›ì•„ì˜¬ë¦¼/ë‚´ë¦¼ ì—†ìŒ)</option>
                    <option value="ë³´í†µ" selected>ë³´í†µ (ë°›ì•„ì˜¬ë¦¼/ë‚´ë¦¼ 1ë²ˆ)</option>
                    <option value="ì–´ë ¤ì›€">ì–´ë ¤ì›€ (ë°›ì•„ì˜¬ë¦¼/ë‚´ë¦¼ ì—¬ëŸ¬ ë²ˆ)</option>
                </select>
            </div>
            <div class="input-group">
                <label for="problemType">ë¬¸ì œ ì¢…ë¥˜ë¥¼ ì„ íƒí•˜ì„¸ìš”:</label>
                <select id="problemType">
                    <optgroup label="ì´ˆë“±í•™êµ 3í•™ë…„">
                        <option value="ë§ì…ˆ">ë§ì…ˆ</option>
                        <option value="ëº„ì…ˆ">ëº„ì…ˆ</option>
                        <option value="í˜¼í•©" selected>í˜¼í•© (ë§ì…ˆ, ëº„ì…ˆ)</option>
                    </optgroup>
                    <optgroup label="ê¸°ë³¸ ì—°ì‚°">
                        <option value="ê³±ì…ˆ">ê³±ì…ˆ</option>
                        <option value="ë‚˜ëˆ—ì…ˆ">ë‚˜ëˆ—ì…ˆ</option>
                    </optgroup>
                    <optgroup label="ì¤‘í•™êµ 1í•™ë…„ ê³¼ì •">
                        <option value="ì†Œì¸ìˆ˜ë¶„í•´">ì†Œì¸ìˆ˜ë¶„í•´</option>
                        <option value="ì •ìˆ˜ì™€ìœ ë¦¬ìˆ˜">ì •ìˆ˜ì™€ ìœ ë¦¬ìˆ˜</option>
                        <option value="ì¼ì°¨ë°©ì •ì‹">ì¼ì°¨ë°©ì •ì‹</option>
                        <option value="ì¢Œí‘œí‰ë©´">ì¢Œí‘œí‰ë©´ê³¼ ê·¸ë˜í”„</option>
                        <option value="ë¹„ë¡€">ì •ë¹„ë¡€ì™€ ë°˜ë¹„ë¡€</option>
                        <option value="ê¸°ë³¸ë„í˜•">ê¸°ë³¸ë„í˜•</option>
                        <option value="ë‹¤ê°í˜•">ë‹¤ê°í˜•</option>
                        <option value="ì›ê³¼ë¶€ì±„ê¼´">ì›ê³¼ ë¶€ì±„ê¼´</option>
                        <option value="ì…ì²´ë„í˜•">ì…ì²´ë„í˜•</option>
                        <option value="íšŒì „ì²´">íšŒì „ì²´</option>
                        <option value="í†µê³„">í†µê³„</option>
                        <option value="ì¤‘1í˜¼í•©">ì¤‘1 ê³¼ì • í˜¼í•©</option>
                    </optgroup>
                </select>
            </div>
            <div class="input-group">
                <label for="problemCount">ë¬¸ì œ ìˆ˜ë¥¼ ì„ íƒí•˜ì„¸ìš”:</label>
                <select id="problemCount">
                    <option value="5">5ë¬¸ì œ</option>
                    <option value="10" selected>10ë¬¸ì œ</option>
                    <option value="15">15ë¬¸ì œ</option>
                    <option value="20">20ë¬¸ì œ</option>
                    <option value="30">30ë¬¸ì œ</option>
                </select>
            </div>
            <div class="setup-controls">
                <button onclick="showMainMenu()" class="back-btn">ë’¤ë¡œ ê°€ê¸°</button>
                <button onclick="beginQuiz()" class="start-quiz-btn">ğŸ® í€´ì¦ˆ ì‹œì‘í•˜ê¸°</button>
            </div>
        </div>

        <div id="quizProgress" class="quiz-section">
            <div class="progress">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <div id="questionCard" class="question-card">
                <div class="question" id="questionText"></div>
                <div id="questionImage" class="question-image" style="display: none;"></div>
                <div class="choices" id="choicesContainer"></div>
            </div>
            <div class="quiz-controls">
                <button onclick="showMainMenu()" class="back-btn">ë©”ì¸ìœ¼ë¡œ</button>
                <button onclick="nextQuestion()" id="nextBtn" class="next-btn" style="display: none;">ë‹¤ìŒ ë¬¸ì œ â†’</button>
            </div>
        </div>

        <div id="quizResult" class="quiz-section">
            <div class="result" id="resultCard">
                <div class="score" id="scoreText"></div>
                <div id="resultMessage"></div>
            </div>
            
            <div class="explanation-section" id="explanationSection">
                <div class="explanation-title">í‹€ë¦° ë¬¸ì œ í•´ì„¤ ë° í’€ì´ ë°©ë²•</div>
                <div id="wrongAnswersContainer"></div>
            </div>
            
            <button onclick="showMainMenu()" class="center-back-btn">ğŸ  ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>

        <div id="recordsView" class="quiz-section">
            <h2>ğŸ“‹ í€´ì¦ˆ ê¸°ë¡</h2>
            <div class="records" id="recordsContainer">
                <p>ì•„ì§ í€´ì¦ˆ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
            <button onclick="showMainMenu()" class="back-btn">ë’¤ë¡œ ê°€ê¸°</button>
        </div>
    </div>

    <script>
        const sections = document.querySelectorAll('.quiz-section');
        const mainMenu = document.getElementById('mainMenu');
        const quizSetup = document.getElementById('quizSetup');
        const quizProgress = document.getElementById('quizProgress');
        const quizResult = document.getElementById('quizResult');
        const recordsView = document.getElementById('recordsView');

        const questionText = document.getElementById('questionText');
        const choicesContainer = document.getElementById('choicesContainer');
        const nextBtn = document.getElementById('nextBtn');
        const progressBar = document.getElementById('progressBar');
        const resultCard = document.getElementById('resultCard');
        const scoreText = document.getElementById('scoreText');
        const resultMessage = document.getElementById('resultMessage');
        const explanationSection = document.getElementById('explanationSection');
        const wrongAnswersContainer = document.getElementById('wrongAnswersContainer');
        const questionImage = document.getElementById('questionImage');

        let currentQuiz = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let wrongAnswers = [];
        let records = [];
        let userSuggestions = [];
        let selectedProblemType = '';
        let selectedDifficulty = '';

        const problems = {
            'ë§ì…ˆ': {
                'ì‰¬ì›€': [
                    { q: '234 + 121', a: '355', type: 'no_carry' },
                    { q: '542 + 231', a: '773', type: 'no_carry' },
                    { q: '172 + 315', a: '487', type: 'no_carry' },
                    { q: '401 + 598', a: '999', type: 'no_carry' },
                    { q: '634 + 324', a: '958', type: 'no_carry' },
                    { q: '121 + 778', a: '899', type: 'no_carry' },
                    { q: '328 + 121', a: '449', type: 'no_carry' },
                ],
                'ë³´í†µ': [
                    { q: '343 + 116', a: '459', type: 'one_carry_add' },
                    { q: '284 + 911', a: '1195', type: 'one_carry_add' },
                    { q: '471 + 578', a: '1049', type: 'one_carry_add' },
                    { q: '435 + 363', a: '798', type: 'one_carry_add' },
                    { q: '353 + 368', a: '721', type: 'one_carry_add' },
                    { q: '871 + 273', a: '1144', type: 'one_carry_add' },
                    { q: '963 + 632', a: '1595', type: 'one_carry_add' },
                    { q: '762 + 823', a: '1585', type: 'one_carry_add' },
                    { q: '417 + 683', a: '1100', type: 'one_carry_add' },
                ],
                'ì–´ë ¤ì›€': [
                    { q: '428 + 496', a: '924', type: 'multi_carry_add' },
                    { q: '273 + 532', a: '805', type: 'multi_carry_add' },
                    { q: '378 + 373', a: '751', type: 'multi_carry_add' },
                    { q: '834 + 631', a: '1465', type: 'multi_carry_add' },
                    { q: '798 + 698', a: '1496', type: 'multi_carry_add' },
                    { q: '377 + 976', a: '1353', type: 'multi_carry_add' },
                    { q: '911 + 719', a: '1630', type: 'multi_carry_add' },
                    { q: '288 + 845', a: '1133', type: 'multi_carry_add' },
                    { q: '814 + 689', a: '1503', type: 'multi_carry_add' },
                ]
            },
            'ëº„ì…ˆ': {
                'ì‰¬ì›€': [
                    { q: '914 - 231', a: '683', type: 'no_borrow' },
                    { q: '896 - 283', a: '613', type: 'no_borrow' },
                    { q: '777 - 154', a: '623', type: 'no_borrow' },
                    { q: '579 - 412', a: '167', type: 'no_borrow' },
                    { q: '898 - 465', a: '433', type: 'no_borrow' },
                    { q: '768 - 257', a: '511', type: 'no_borrow' },
                    { q: '988 - 554', a: '434', type: 'no_borrow' },
                ],
                'ë³´í†µ': [
                    { q: '740 - 253', a: '487', type: 'one_borrow' },
                    { q: '679 - 398', a: '281', type: 'one_borrow' },
                    { q: '946 - 795', a: '151', type: 'one_borrow' },
                    { q: '496 - 233', a: '263', type: 'one_borrow' },
                    { q: '904 - 449', a: '455', type: 'one_borrow' },
                    { q: '965 - 718', a: '247', type: 'one_borrow' },
                    { q: '603 - 428', a: '175', type: 'one_borrow' },
                ],
                'ì–´ë ¤ì›€': [
                    { q: '343 - 116', a: '227', type: 'multi_borrow' },
                    { q: '748 - 594', a: '154', type: 'multi_borrow' },
                    { q: '677 - 295', a: '382', type: 'multi_borrow' },
                    { q: '990 - 564', a: '426', type: 'multi_borrow' },
                    { q: '861 - 636', a: '225', type: 'multi_borrow' },
                    { q: '852 - 233', a: '619', type: 'multi_borrow' },
                    { q: '934 - 135', a: '799', type: 'multi_borrow' },
                ]
            },
            'ê³±ì…ˆ': {
                'ì‰¬ì›€': [
                    { q: '12 Ã— 3', a: '36', type: 'simple_multi' }, { q: '21 Ã— 4', a: '84', type: 'simple_multi' },
                    { q: '15 Ã— 5', a: '75', type: 'simple_multi' }, { q: '11 Ã— 6', a: '66', type: 'simple_multi' },
                    { q: '24 Ã— 2', a: '48', type: 'simple_multi' }, { q: '30 Ã— 3', a: '90', type: 'simple_multi' }
                ],
                'ë³´í†µ': [
                    { q: '37 Ã— 8', a: '296', type: 'one_carry_multi' }, { q: '45 Ã— 12', a: '540', type: 'multi_digit_multi' },
                    { q: '64 Ã— 9', a: '576', type: 'one_carry_multi' }, { q: '28 Ã— 15', a: '420', type: 'multi_digit_multi' },
                    { q: '53 Ã— 7', a: '371', type: 'one_carry_multi' }, { q: '18 Ã— 22', a: '396', type: 'multi_digit_multi' },
                    { q: '76 Ã— 13', a: '988', type: 'multi_digit_multi' }, { q: '88 Ã— 9', a: '792', type: 'one_carry_multi' }
                ],
                'ì–´ë ¤ì›€': [
                    { q: '123 Ã— 45', a: '5535', type: 'complex_multi' }, { q: '245 Ã— 18', a: '4410', type: 'complex_multi' },
                    { q: '371 Ã— 23', a: '8533', type: 'complex_multi' }, { q: '409 Ã— 56', a: '22904', type: 'complex_multi' },
                    { q: '512 Ã— 34', a: '17408', type: 'complex_multi' }, { q: '687 Ã— 19', a: '13053', type: 'complex_multi' }
                ]
            },
            'ë‚˜ëˆ—ì…ˆ': {
                'ì‰¬ì›€': [
                    { q: '36 Ã· 6', a: '6', type: 'simple_div' }, { q: '81 Ã· 9', a: '9', type: 'simple_div' },
                    { q: '42 Ã· 7', a: '6', type: 'simple_div' }, { q: '25 Ã· 5', a: '5', type: 'simple_div' },
                    { q: '48 Ã· 8', a: '6', type: 'simple_div' }, { q: '54 Ã· 9', a: '6', type: 'simple_div' }
                ],
                'ë³´í†µ': [
                    { q: '45 Ã· 3', a: '15', type: 'one_digit_div' }, { q: '72 Ã· 4', a: '18', type: 'one_digit_div' },
                    { q: '65 Ã· 5', a: '13', type: 'one_digit_div' }, { q: '84 Ã· 6', a: '14', type: 'one_digit_div' },
                    { q: '91 Ã· 7', a: '13', type: 'one_digit_div' }, { q: '108 Ã· 9', a: '12', type: 'one_digit_div' }
                ],
                'ì–´ë ¤ì›€': [
                    { q: '128 Ã· 4', a: '32', type: 'complex_div' }, { q: '576 Ã· 12', a: '48', type: 'complex_div' },
                    { q: '216 Ã· 8', a: '27', type: 'complex_div' }, { q: '360 Ã· 15', a: '24', type: 'complex_div' },
                    { q: '450 Ã· 18', a: '25', type: 'complex_div' }, { q: '585 Ã· 13', a: '45', type: 'complex_div' }
                ]
            },
            'ì†Œì¸ìˆ˜ë¶„í•´': {
                'ì‰¬ì›€': [
                    { q: 'ì†Œì¸ìˆ˜ë¶„í•´í•˜ì„¸ìš”: 12', a: '2^2 Ã— 3', type: 'prime_factor' },
                    { q: 'ì†Œì¸ìˆ˜ë¶„í•´í•˜ì„¸ìš”: 18', a: '2 Ã— 3^2', type: 'prime_factor' },
                    { q: 'ì†Œì¸ìˆ˜ë¶„í•´í•˜ì„¸ìš”: 20', a: '2^2 Ã— 5', type: 'prime_factor' }
                ],
                'ë³´í†µ': [
                    { q: 'ì†Œì¸ìˆ˜ë¶„í•´í•˜ì„¸ìš”: 72', a: '2^3 Ã— 3^2', type: 'prime_factor' },
                    { q: 'ì†Œì¸ìˆ˜ë¶„í•´í•˜ì„¸ìš”: 100', a: '2^2 Ã— 5^2', type: 'prime_factor' },
                    { q: 'ì†Œì¸ìˆ˜ë¶„í•´í•˜ì„¸ìš”: 84', a: '2^2 Ã— 3 Ã— 7', type: 'prime_factor' }
                ],
                'ì–´ë ¤ì›€': [
                    { q: 'ì†Œì¸ìˆ˜ë¶„í•´í•˜ì„¸ìš”: 120', a: '2^3 Ã— 3 Ã— 5', type: 'prime_factor' },
                    { q: 'ì†Œì¸ìˆ˜ë¶„í•´í•˜ì„¸ìš”: 144', a: '2^4 Ã— 3^2', type: 'prime_factor' },
                    { q: 'ì†Œì¸ìˆ˜ë¶„í•´í•˜ì„¸ìš”: 216', a: '2^3 Ã— 3^3', type: 'prime_factor' }
                ]
            },
            'ì •ìˆ˜ì™€ìœ ë¦¬ìˆ˜': {
                'ì‰¬ì›€': [
                    { q: '(-2) + 5', a: '3', type: 'integer_add' }, { q: '3 - 7', a: '-4', type: 'integer_sub' },
                    { q: '(-1) + (-4)', a: '-5', type: 'integer_add' }, { q: '8 - (-2)', a: '10', type: 'integer_sub' }
                ],
                'ë³´í†µ': [
                    { q: '(-3) Ã— (-4)', a: '12', type: 'integer_multi' }, { q: '(-10) Ã· 2', a: '-5', type: 'integer_div' },
                    { q: '(-5) Ã— 3', a: '-15', type: 'integer_multi' }, { q: '12 Ã· (-4)', a: '-3', type: 'integer_div' }
                ],
                'ì–´ë ¤ì›€': [
                    { q: '(-5) + 3 Ã— (-2)', a: '-11', type: 'integer_mixed' },
                    { q: '8 - ( -4 ) Ã· 2', a: '10', type: 'integer_mixed' },
                    { q: '(3 - 7) Ã— (-2)', a: '8', type: 'integer_mixed' }
                ]
            },
            'ì¼ì°¨ë°©ì •ì‹': {
                'ì‰¬ì›€': [
                    { q: 'x + 3 = 7', a: '4', type: 'linear_eq' }, { q: '2x = 10', a: '5', type: 'linear_eq' },
                    { q: 'x - 4 = 1', a: '5', type: 'linear_eq' }, { q: 'x/2 = 3', a: '6', type: 'linear_eq' }
                ],
                'ë³´í†µ': [
                    { q: '2x - 5 = 11', a: '8', type: 'linear_eq' }, { q: '3(x-1) = 9', a: '4', type: 'linear_eq' },
                    { q: '4x + 2 = 18', a: '4', type: 'linear_eq' }, { q: '5 - 3x = -7', a: '4', type: 'linear_eq' }
                ],
                'ì–´ë ¤ì›€': [
                    { q: '0.5x + 1.5 = 4', a: '5', type: 'linear_eq' },
                    { q: '2x - 1 = x + 3', a: '4', type: 'linear_eq' },
                    { q: '1/2x + 1 = 3/2x - 3', a: '4', type: 'linear_eq' }
                ]
            },
            'ì¢Œí‘œí‰ë©´': {
                'ì‰¬ì›€': [
                    { q: 'ì  (2, 3)ì€ ëª‡ ì‚¬ë¶„ë©´ì— ìˆë‚˜ìš”?', a: 'ì œ1ì‚¬ë¶„ë©´', type: 'quadrant' },
                    { q: 'ì  (-1, -5)ì€ ëª‡ ì‚¬ë¶„ë©´ì— ìˆë‚˜ìš”?', a: 'ì œ3ì‚¬ë¶„ë©´', type: 'quadrant' },
                    { q: 'ì  (-4, 2)ì€ ëª‡ ì‚¬ë¶„ë©´ì— ìˆë‚˜ìš”?', a: 'ì œ2ì‚¬ë¶„ë©´', type: 'quadrant' },
                    { q: 'ì  (5, -3)ì€ ëª‡ ì‚¬ë¶„ë©´ì— ìˆë‚˜ìš”?', a: 'ì œ4ì‚¬ë¶„ë©´', type: 'quadrant' }
                ],
                'ë³´í†µ': [
                    { q: 'ì  (x, y)ê°€ ì œ2ì‚¬ë¶„ë©´ì— ìˆì„ ë•Œ, xì™€ yì˜ ë¶€í˜¸ëŠ”?', a: 'x<0, y>0', type: 'quadrant_sign' },
                    { q: 'ì  (x, y)ê°€ ì œ4ì‚¬ë¶„ë©´ì— ìˆì„ ë•Œ, xì™€ yì˜ ë¶€í˜¸ëŠ”?', a: 'x>0, y<0', type: 'quadrant_sign' }
                ],
                'ì–´ë ¤ì›€': [
                    { q: 'ì  (a,b)ê°€ ì œ3ì‚¬ë¶„ë©´ì— ìˆì„ ë•Œ, ì  (-a, -b)ëŠ” ëª‡ ì‚¬ë¶„ë©´ì— ìˆë‚˜ìš”?', a: 'ì œ1ì‚¬ë¶„ë©´', type: 'quadrant_advanced' }
                ]
            },
            'ë¹„ë¡€': {
                'ì‰¬ì›€': [
                    { q: 'yê°€ xì— ì •ë¹„ë¡€í•˜ê³  x=2ì¼ ë•Œ y=4ì…ë‹ˆë‹¤. x=5ì¼ ë•Œ yì˜ ê°’ì€?', a: '10', type: 'direct_prop' },
                    { q: 'yê°€ xì— ë°˜ë¹„ë¡€í•˜ê³  x=2ì¼ ë•Œ y=4ì…ë‹ˆë‹¤. x=8ì¼ ë•Œ yì˜ ê°’ì€?', a: '1', type: 'inverse_prop' }
                ],
                'ë³´í†µ': [
                    { q: 'ì •ë¹„ë¡€ ê´€ê³„ y=axì˜ ê·¸ë˜í”„ê°€ ì  (3, 6)ì„ ì§€ë‚  ë•Œ, aì˜ ê°’ì€?', a: '2', type: 'direct_prop_eq' },
                    { q: 'ë°˜ë¹„ë¡€ ê´€ê³„ y=a/xì˜ ê·¸ë˜í”„ê°€ ì  (3, 4)ë¥¼ ì§€ë‚  ë•Œ, aì˜ ê°’ì€?', a: '12', type: 'inverse_prop_eq' }
                ],
                'ì–´ë ¤ì›€': [
                    { q: 'yê°€ xì— ë°˜ë¹„ë¡€í•˜ê³  x=6ì¼ ë•Œ y=-2ì…ë‹ˆë‹¤. x=-4ì¼ ë•Œ yì˜ ê°’ì€?', a: '3', type: 'inverse_prop_advanced' }
                ]
            },
            'ê¸°ë³¸ë„í˜•': {
                'ì‰¬ì›€': [
                    { q: 'ì ì´ ëª¨ì—¬ì„œ ë§Œë“¤ì–´ì§€ëŠ” ë„í˜•ì€?', a: 'ì„ ', type: 'geo_line' },
                    { q: 'ë‘ ë°˜ì§ì„ ì´ ì´ë£¨ëŠ” ë„í˜•ì€?', a: 'ê°', type: 'geo_angle' }
                ],
                'ë³´í†µ': [
                    { q: 'ì„œë¡œ ë‹¤ë¥¸ ë‘ ì§ì„ ì´ í•œ ì ì—ì„œ ë§Œë‚  ë•Œ, ê·¸ ì ì„ ë¬´ì—‡ì´ë¼ í•˜ë‚˜ìš”?', a: 'êµì ', type: 'geo_intersect' },
                    { q: 'ë©´ê³¼ ë©´ì´ ë§Œë‚˜ì„œ ìƒê¸°ëŠ” ì„ ì€?', a: 'êµì„ ', type: 'geo_intersect' }
                ],
                'ì–´ë ¤ì›€': [
                    { q: 'ì„œë¡œ ë‹¤ë¥¸ ì„¸ ì§ì„  l, m, nì´ í•œ ì ì—ì„œ ë§Œë‚  ë•Œ, êµì ì˜ ìˆ˜ëŠ”?', a: '1', type: 'geo_intersect_advanced' }
                ]
            },
            'ë‹¤ê°í˜•': {
                'ì‰¬ì›€': [
                    { q: 'ë³€ì´ 3ê°œì¸ ë‹¤ê°í˜•ì€?', a: 'ì‚¼ê°í˜•', type: 'polygon_count' },
                    { q: 'ë³€ì´ 4ê°œì¸ ë‹¤ê°í˜•ì€?', a: 'ì‚¬ê°í˜•', type: 'polygon_count' }
                ],
                'ë³´í†µ': [
                    { q: 'ë‚´ê°ì˜ í•©ì´ 180ë„ì¸ ë„í˜•ì€?', a: 'ì‚¼ê°í˜•', type: 'polygon_sum' },
                    { q: 'ì •ì˜¤ê°í˜•ì˜ í•œ ì™¸ê°ì˜ í¬ê¸°ëŠ”?', a: '72', type: 'polygon_angle' }
                ],
                'ì–´ë ¤ì›€': [
                    { q: 'ì •ìœ¡ê°í˜•ì˜ í•œ ë‚´ê°ì˜ í¬ê¸°ëŠ”?', a: '120', type: 'polygon_angle' },
                    { q: 'ëŒ€ê°ì„ ì˜ ìˆ˜ê°€ 9ê°œì¸ ë‹¤ê°í˜•ì€?', a: 'ìœ¡ê°í˜•', type: 'polygon_diagonal' }
                ]
            },
            'ì›ê³¼ë¶€ì±„ê¼´': {
                'ì‰¬ì›€': [
                    { q: 'ì›ì˜ ì¤‘ì‹¬ì„ ì§€ë‚˜ëŠ” ê°€ì¥ ê¸´ í˜„ì€?', a: 'ì§€ë¦„', type: 'circle_term' },
                    { q: 'ì›ì˜ ë‘˜ë ˆë¥¼ ë¬´ì—‡ì´ë¼ê³  í•˜ë‚˜ìš”?', a: 'ì›ì£¼', type: 'circle_term' }
                ],
                'ë³´í†µ': [
                    { q: 'ë°˜ì§€ë¦„ì´ 5cmì¸ ì›ì˜ ë‘˜ë ˆëŠ”?', a: '10Ï€', type: 'circle_perimeter' },
                    { q: 'ë°˜ì§€ë¦„ì´ 4cmì¸ ì›ì˜ ë„“ì´ëŠ”?', a: '16Ï€', type: 'circle_area' }
                ],
                'ì–´ë ¤ì›€': [
                    { q: 'ì¤‘ì‹¬ê°ì´ 90ë„ì´ê³  ë°˜ì§€ë¦„ì´ 4cmì¸ ë¶€ì±„ê¼´ì˜ ë„“ì´ëŠ”?', a: '4Ï€', type: 'sector_area' },
                    { q: 'í˜¸ì˜ ê¸¸ì´ê°€ 3Ï€ì´ê³  ë°˜ì§€ë¦„ì´ 6cmì¸ ë¶€ì±„ê¼´ì˜ ë„“ì´ëŠ”?', a: '9Ï€', type: 'sector_area_arc' }
                ]
            },
            'ì…ì²´ë„í˜•': {
                'ì‰¬ì›€': [
                    { q: 'ì •ìœ¡ë©´ì²´ì˜ ê¼­ì§“ì ì˜ ìˆ˜ëŠ”?', a: '8', type: '3d_cube' },
                    { q: 'ë°‘ë©´ì´ ì›ì¸ ê¸°ë‘¥ì€?', a: 'ì›ê¸°ë‘¥', type: '3d_cylinder' }
                ],
                'ë³´í†µ': [
                    { q: 'ë°‘ë©´ì˜ ëª¨ì–‘ì´ ì‚¬ê°í˜•ì¸ ê°ê¸°ë‘¥ì˜ ë©´ì˜ ìˆ˜ëŠ”?', a: '6', type: '3d_prism' },
                    { q: 'ì‚¼ê°ë¿”ì˜ ëª¨ì„œë¦¬ì˜ ìˆ˜ëŠ”?', a: '6', type: '3d_pyramid' }
                ],
                'ì–´ë ¤ì›€': [
                    { q: 'ì˜¤ê°ë¿”ëŒ€ì˜ ë©´ì˜ ìˆ˜ëŠ”?', a: '7', type: '3d_frustum' }
                ]
            },
            'íšŒì „ì²´': {
                'ì‰¬ì›€': [
                    { q: 'ì§ì‚¬ê°í˜•ì„ í•œ ë³€ì„ ì¶•ìœ¼ë¡œ íšŒì „ì‹œì¼œ ì–»ëŠ” ë„í˜•ì€?', a: 'ì›ê¸°ë‘¥', type: 'revo_rect' },
                    { q: 'ë°˜ì›ì„ ì§€ë¦„ì„ ì¶•ìœ¼ë¡œ íšŒì „ì‹œì¼œ ì–»ëŠ” ë„í˜•ì€?', a: 'êµ¬', type: 'revo_semi' }
                ],
                'ë³´í†µ': [
                    { q: 'ì§ê°ì‚¼ê°í˜•ì„ í•œ ë³€ì„ ì¶•ìœ¼ë¡œ íšŒì „ì‹œì¼œ ì–»ëŠ” ë„í˜•ì€?', a: 'ì›ë¿”', type: 'revo_tri' },
                    { q: 'ì‚¬ë‹¤ë¦¬ê¼´ì„ í•œ ë³€ì„ ì¶•ìœ¼ë¡œ íšŒì „ì‹œì¼œ ì–»ëŠ” ë„í˜•ì€?', a: 'ì›ë¿”ëŒ€', type: 'revo_trapezoid' }
                ],
                'ì–´ë ¤ì›€': [
                    { q: 'ë‹¤ìŒ ì¤‘ íšŒì „ì²´ê°€ ì•„ë‹Œ ê²ƒì€?', a: 'ì‚¼ê°ë¿”', type: 'revo_not' }
                ]
            },
            'í†µê³„': {
                'ì‰¬ì›€': [
                    { q: 'ê°€ì¥ ìì£¼ ë‚˜ì˜¤ëŠ” ê°’ì„ ë¬´ì—‡ì´ë¼ í•˜ë‚˜ìš”?', a: 'ìµœë¹ˆê°’', type: 'stat_mode' },
                    { q: 'ìë£Œë¥¼ í¬ê¸° ìˆœìœ¼ë¡œ ë‚˜ì—´í–ˆì„ ë•Œ í•œê°€ìš´ë° ìˆëŠ” ê°’ì€?', a: 'ì¤‘ì•™ê°’', type: 'stat_median' }
                ],
                'ë³´í†µ': [
                    { q: '1, 2, 3, 4, 5ì˜ í‰ê· ì€?', a: '3', type: 'stat_mean' },
                    { q: '1, 2, 2, 3, 4ì˜ ìµœë¹ˆê°’ì€?', a: '2', type: 'stat_mode' }
                ],
                'ì–´ë ¤ì›€': [
                    { q: 'í¸ì°¨ì˜ ì œê³±ì˜ í‰ê· ì„ ë¬´ì—‡ì´ë¼ê³  í•˜ë‚˜ìš”?', a: 'ë¶„ì‚°', type: 'stat_variance' }
                ]
            }
        };

        function showSection(sectionId) {
            sections.forEach(section => {
                if (section.id === sectionId) {
                    section.classList.add('active');
                } else {
                    section.classList.remove('active');
                }
            });
        }

        function showMainMenu() {
            showSection('mainMenu');
        }

        function startQuiz() {
            showSection('quizSetup');
            document.getElementById('grade').value = "3";
            document.getElementById('problemType').value = "í˜¼í•©";
            document.getElementById('problemCount').value = "10";
            updateGradeDisplay();
        }

        function beginQuiz() {
            const problemCount = parseInt(document.getElementById('problemCount').value);
            selectedDifficulty = document.getElementById('difficulty').value;
            selectedProblemType = document.getElementById('problemType').value;
            const userName = document.getElementById('userName').value.trim() || 'ì´ë¦„ ì—†ìŒ';
            const grade = document.getElementById('grade').value;

            score = 0;
            currentQuestionIndex = 0;
            wrongAnswers = [];
            
            currentQuiz = generateQuiz(problemCount, selectedProblemType, selectedDifficulty);

            if (currentQuiz.length === 0) {
                alert('ì„ íƒí•˜ì‹  ì¡°ê±´ì— ë§ëŠ” ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ì„¤ì •ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                showMainMenu();
                return;
            }

            showSection('quizProgress');
            nextBtn.style.display = 'none';
            displayQuestion();
        }
        
        function generateQuiz(count, problemType, difficulty) {
            let pool = [];

            if (problemType === 'í˜¼í•©') {
                const addPool = problems['ë§ì…ˆ'][difficulty] || [];
                const subPool = problems['ëº„ì…ˆ'][difficulty] || [];
                pool = [...addPool, ...subPool];
            } else if (problems[problemType] && problems[problemType][difficulty]) {
                pool = problems[problemType][difficulty];
            }

            // ë¬¸ì œ í’€ì´ ì¶©ë¶„í•˜ì§€ ì•Šìœ¼ë©´ ì¡´ì¬í•˜ëŠ” ë¬¸ì œë§Œ ë°˜í™˜
            if (pool.length < count) {
                alert(`ì„ íƒí•˜ì‹  ë‚œì´ë„ì™€ ë¬¸ì œ ìœ í˜•ì—ëŠ” ${count}ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤. ì¡´ì¬í•˜ëŠ” ëª¨ë“  ${pool.length}ë¬¸ì œë¥¼ ì¶œì œí•©ë‹ˆë‹¤.`);
            }

            const shuffledPool = shuffleArray(pool);
            return shuffledPool.slice(0, count);
        }

        function generateChoices(answer, problemType) {
            const choices = [answer];
            while (choices.length < 4) {
                let wrongAnswer;
                const problemTypesWithFixedAnswers = ['ì¢Œí‘œí‰ë©´', 'ê¸°ë³¸ë„í˜•', 'ë‹¤ê°í˜•', 'ì›ê³¼ë¶€ì±„ê¼´', 'ì…ì²´ë„í˜•', 'íšŒì „ì²´', 'í†µê³„'];
                
                if (problemTypesWithFixedAnswers.includes(problemType)) {
                     // ë¬¸ìì—´ ê¸°ë°˜ ë¬¸ì œì˜ ì˜¤ë‹µ ìƒì„±
                     const wrongOptions = {
                        'ì¢Œí‘œí‰ë©´': ['ì œ1ì‚¬ë¶„ë©´', 'ì œ2ì‚¬ë¶„ë©´', 'ì œ3ì‚¬ë¶„ë©´', 'ì œ4ì‚¬ë¶„ë©´', 'xì¶•', 'yì¶•'],
                        'ê¸°ë³¸ë„í˜•': ['ì ', 'ì„ ', 'ë©´', 'ê°', 'êµì ', 'êµì„ '],
                        'ë‹¤ê°í˜•': ['ì‚¼ê°í˜•', 'ì‚¬ê°í˜•', 'ì˜¤ê°í˜•', 'ìœ¡ê°í˜•', 'ì¹ ê°í˜•'],
                        'ì›ê³¼ë¶€ì±„ê¼´': ['í˜„', 'í˜¸', 'ë°˜ì§€ë¦„', 'ì§€ë¦„', 'ì›ì£¼', 'ì¤‘ì‹¬ê°', 'ë¶€ì±„ê¼´'],
                        'ì…ì²´ë„í˜•': ['ì •ìœ¡ë©´ì²´', 'ì›ê¸°ë‘¥', 'ì›ë¿”', 'êµ¬', 'ê°ê¸°ë‘¥', 'ê°ë¿”'],
                        'íšŒì „ì²´': ['ì›ë¿”', 'ì›ê¸°ë‘¥', 'êµ¬', 'ì›ë¿”ëŒ€', 'ì›'],
                        'í†µê³„': ['í‰ê· ', 'ì¤‘ì•™ê°’', 'ìµœë¹ˆê°’', 'ë¶„ì‚°', 'í‘œì¤€í¸ì°¨'],
                    };
                    const potentialWrongs = wrongOptions[problemType] || [];
                    if (potentialWrongs.length > 0) {
                        wrongAnswer = potentialWrongs[Math.floor(Math.random() * potentialWrongs.length)];
                    } else {
                        wrongAnswer = 'ì˜¤ë‹µ';
                    }
                } else {
                     // ìˆ«ì ê¸°ë°˜ ë¬¸ì œì˜ ì˜¤ë‹µ ìƒì„±
                     wrongAnswer = (parseInt(answer) + Math.floor(Math.random() * 20) - 10).toString();
                }
                
                if (!choices.includes(wrongAnswer)) {
                    choices.push(wrongAnswer);
                }
            }
            return shuffleArray(choices);
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function displayQuestion() {
            if (currentQuestionIndex < currentQuiz.length) {
                const question = currentQuiz[currentQuestionIndex];
                questionText.textContent = question.q;
                choicesContainer.innerHTML = '';
                questionImage.style.display = 'none';
                
                if (question.image) {
                    questionImage.innerHTML = question.image;
                    questionImage.style.display = 'flex';
                }

                question.choices = generateChoices(question.a, selectedProblemType);

                question.choices.forEach(choice => {
                    const button = document.createElement('button');
                    button.textContent = choice;
                    button.className = 'choice-btn';
                    button.onclick = () => checkAnswer(button, choice, question);
                    choicesContainer.appendChild(button);
                });

                updateProgressBar();
            } else {
                showResult();
            }
        }

        function checkAnswer(button, selectedChoice, question) {
            const isCorrect = (selectedChoice.toString() === question.a);
            const allChoiceBtns = choicesContainer.querySelectorAll('.choice-btn');

            allChoiceBtns.forEach(btn => {
                btn.disabled = true;
                if (btn.textContent.toString() === question.a) {
                    btn.classList.add('correct');
                } else if (btn === button) {
                    btn.classList.add('wrong');
                }
            });

            if (isCorrect) {
                score++;
            } else {
                wrongAnswers.push(question);
            }

            nextBtn.style.display = 'block';
        }

        function nextQuestion() {
            currentQuestionIndex++;
            nextBtn.style.display = 'none';
            displayQuestion();
        }

        function updateProgressBar() {
            const progress = (currentQuestionIndex / currentQuiz.length) * 100;
            progressBar.style.width = `${progress}%`;
        }

        function showResult() {
            showSection('quizResult');
            updateProgressBar();

            const totalQuestions = currentQuiz.length;
            const percentage = (score / totalQuestions) * 100;

            scoreText.textContent = `${score} / ${totalQuestions} ë¬¸ì œ ì •ë‹µ!`;
            if (percentage >= 80) {
                resultMessage.textContent = 'ğŸ‰ í›Œë¥­í•©ë‹ˆë‹¤! ì•„ì£¼ ì˜í–ˆì–´ìš”!';
                resultCard.style.backgroundColor = '#e8f5e8';
                resultCard.style.borderColor = '#4CAF50';
            } else if (percentage >= 50) {
                resultMessage.textContent = 'ğŸ‘ ì˜í–ˆìŠµë‹ˆë‹¤! ì¡°ê¸ˆë§Œ ë” ë…¸ë ¥í•´ ë´ìš”!';
                resultCard.style.backgroundColor = '#fff8e1';
                resultCard.style.borderColor = '#ffc107';
            } else {
                resultMessage.textContent = 'ğŸ’ª í˜ë‚´ì„¸ìš”! ë‹¤ì‹œ í•œë²ˆ ë„ì „í•´ ë³´ì„¸ìš”!';
                resultCard.style.backgroundColor = '#ffebee';
                resultCard.style.borderColor = '#f44336';
            }
            resultCard.style.display = 'block';

            if (wrongAnswers.length > 0) {
                explanationSection.classList.add('show');
                displayWrongAnswers();
            } else {
                explanationSection.classList.remove('show');
            }
            saveRecord();
        }

        function displayWrongAnswers() {
            wrongAnswersContainer.innerHTML = '';
            wrongAnswers.forEach(wrongQ => {
                const wrongItem = document.createElement('div');
                wrongItem.className = 'wrong-answer-item';
                wrongItem.innerHTML = `
                    <div class="wrong-answer-question">ë¬¸ì œ: ${wrongQ.q}</div>
                    <div class="wrong-answer-details">ì •ë‹µ: ${wrongQ.a}</div>
                    <div class="explanation-content">${getExplanation(wrongQ.type, wrongQ.q, wrongQ.a)}</div>
                `;
                wrongAnswersContainer.appendChild(wrongItem);
            });
        }

        function getExplanation(type, question, answer) {
            let explanation = '';
            let tip = '';
            
            // ê³µí†µ ë³€ìˆ˜
            const [num1, num2] = question.replace(/ /g, '').split(/[+-Ã—Ã·=]/).map(Number).filter(n => !isNaN(n));
            const operator = question.match(/[+Ã—Ã·=-]/) ? question.match(/[+Ã—Ã·=-]/)[0] : '';
            
            switch(type) {
                case 'no_carry':
                case 'one_carry_add':
                case 'multi_carry_add':
                    explanation = `ë§ì…ˆ ë¬¸ì œ í’€ì´ì…ë‹ˆë‹¤: ê° ìë¦¬ì˜ ìˆ«ìë¥¼ ë”í•˜ê³ , 10ì´ ë„˜ìœ¼ë©´ ë‹¤ìŒ ìë¦¬ë¡œ ë°›ì•„ì˜¬ë¦¼í•©ë‹ˆë‹¤.`;
                    tip = 'ë°›ì•„ì˜¬ë¦¼ì„ ì •í™•í•˜ê²Œ í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.';
                    break;
                case 'no_borrow':
                case 'one_borrow':
                case 'multi_borrow':
                    explanation = `ëº„ì…ˆ ë¬¸ì œ í’€ì´ì…ë‹ˆë‹¤: ê° ìë¦¬ì˜ ìˆ«ìë¥¼ ë¹¼ê³ , ë¶€ì¡±í•˜ë©´ ìœ—ìë¦¬ì—ì„œ 10ì„ ë°›ì•„ë‚´ë¦¼í•©ë‹ˆë‹¤.`;
                    tip = 'ë°›ì•„ë‚´ë¦¼ì„ ì •í™•í•˜ê²Œ í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.';
                    break;
                case 'simple_multi':
                case 'one_carry_multi':
                case 'multi_digit_multi':
                case 'complex_multi':
                    explanation = `ê³±ì…ˆ ë¬¸ì œ í’€ì´ì…ë‹ˆë‹¤: ê° ìë¦¬ì— ë”°ë¼ ê³±í•œ í›„, ë”í•´ì„œ ìµœì¢… ê²°ê³¼ë¥¼ êµ¬í•©ë‹ˆë‹¤.`;
                    tip = 'ìë¦¬ìˆ˜ì— ë§ì¶° ê³±ì…ˆì„ í•˜ê³ , ë”í•  ë•Œ ìë¦¿ìˆ˜ë¥¼ ì˜ ë§ì¶°ì•¼ í•©ë‹ˆë‹¤.';
                    break;
                case 'simple_div':
                case 'one_digit_div':
                case 'complex_div':
                    explanation = `ë‚˜ëˆ—ì…ˆ ë¬¸ì œ í’€ì´ì…ë‹ˆë‹¤: ë‚˜ëˆ„ëŠ” ìˆ˜ë¡œ ë‚˜ëˆ„ì–´ì§€ëŠ” ìˆ˜ë¥¼ ëª‡ ë²ˆ ëº„ ìˆ˜ ìˆëŠ”ì§€ ìƒê°í•˜ë©° ëª«ì„ êµ¬í•©ë‹ˆë‹¤.`;
                    tip = 'ë‚˜ëˆ„ëŠ” ìˆ˜ì™€ ê°€ê¹Œìš´ ê³±ì…ˆ ê°’ì„ ì°¾ì•„ë³´ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.';
                    break;
                case 'prime_factor':
                    explanation = `ì†Œì¸ìˆ˜ë¶„í•´ í’€ì´ì…ë‹ˆë‹¤: ì£¼ì–´ì§„ ìˆ˜ë¥¼ ì†Œìˆ˜ì¸ ì¸ìˆ˜ë“¤ì˜ ê³±ìœ¼ë¡œ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.`;
                    tip = 'ê°€ì¥ ì‘ì€ ì†Œìˆ˜ë¶€í„° ì°¨ë¡€ëŒ€ë¡œ ë‚˜ëˆ„ì–´ë³´ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.';
                    break;
                case 'integer_add':
                case 'integer_sub':
                case 'integer_multi':
                case 'integer_div':
                case 'integer_mixed':
                    explanation = `ì •ìˆ˜ì™€ ìœ ë¦¬ìˆ˜ ì—°ì‚° í’€ì´ì…ë‹ˆë‹¤: ë¶€í˜¸ì— ì£¼ì˜í•˜ë©° ê³„ì‚°í•©ë‹ˆë‹¤. ê³±ì…ˆ/ë‚˜ëˆ—ì…ˆì—ì„œëŠ” ê°™ì€ ë¶€í˜¸ëŠ” ì–‘ìˆ˜, ë‹¤ë¥¸ ë¶€í˜¸ëŠ” ìŒìˆ˜ê°€ ë©ë‹ˆë‹¤.`;
                    tip = 'ë¶€í˜¸ë¥¼ ë¨¼ì € ê²°ì •í•˜ê³ , ì ˆëŒ“ê°’ë¼ë¦¬ ê³„ì‚°í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.';
                    break;
                case 'linear_eq':
                    explanation = `ì¼ì°¨ë°©ì •ì‹ í’€ì´ì…ë‹ˆë‹¤: xë¥¼ í•œìª½ì— ë‚¨ê¸°ë„ë¡ ì´í•­í•˜ê±°ë‚˜ ì–‘ë³€ì„ ê°™ì€ ìˆ˜ë¡œ ë‚˜ëˆ„ì–´ xì˜ ê°’ì„ êµ¬í•©ë‹ˆë‹¤.`;
                    tip = 'ì¢Œë³€ì—ëŠ” xë¥¼ í¬í•¨í•œ í•­, ìš°ë³€ì—ëŠ” ìƒìˆ˜í•­ì„ ëª¨ìœ¼ëŠ” ê²ƒì´ ê¸°ë³¸ì…ë‹ˆë‹¤.';
                    break;
                case 'quadrant':
                case 'quadrant_sign':
                    explanation = `ì¢Œí‘œí‰ë©´ í’€ì´ì…ë‹ˆë‹¤: xì¶•ê³¼ yì¶•ì˜ ë¶€í˜¸ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì‚¬ë¶„ë©´ì„ íŒë‹¨í•©ë‹ˆë‹¤.`;
                    tip = 'ì œ1ì‚¬ë¶„ë©´(+, +), ì œ2ì‚¬ë¶„ë©´(-, +), ì œ3ì‚¬ë¶„ë©´(-, -), ì œ4ì‚¬ë¶„ë©´(+, -)ì„ ê¸°ì–µí•˜ì„¸ìš”.';
                    break;
                case 'direct_prop':
                case 'inverse_prop':
                case 'direct_prop_eq':
                    explanation = `ë¹„ë¡€ ê´€ê³„ í’€ì´ì…ë‹ˆë‹¤: ì •ë¹„ë¡€ëŠ” y=ax, ë°˜ë¹„ë¡€ëŠ” y=a/x ê³µì‹ì„ ì‚¬ìš©í•˜ì—¬ ë¬¸ì œë¥¼ í•´ê²°í•©ë‹ˆë‹¤.`;
                    tip = 'ë‘ ë³€ìˆ˜ ì‚¬ì´ì˜ ê´€ê³„ì‹ì„ ì •í™•íˆ íŒŒì•…í•˜ëŠ” ê²ƒì´ í•µì‹¬ì…ë‹ˆë‹¤.';
                    break;
                case 'geo_line':
                case 'geo_angle':
                case 'geo_intersect':
                    explanation = `ê¸°ë³¸ ë„í˜• í’€ì´ì…ë‹ˆë‹¤: ì , ì„ , ë©´ì˜ ì •ì˜ì™€ ê´€ê³„ë¥¼ ì´í•´í•´ì•¼ í•©ë‹ˆë‹¤.`;
                    tip = 'ë„í˜•ì˜ ê¸°ë³¸ ê°œë…ê³¼ ìš©ì–´ë¥¼ ë‹¤ì‹œ í•œë²ˆ í™•ì¸í•´ë³´ì„¸ìš”.';
                    break;
                case 'polygon_count':
                case 'polygon_sum':
                case 'polygon_angle':
                    explanation = `ë‹¤ê°í˜• ë¬¸ì œ í’€ì´ì…ë‹ˆë‹¤: ë‹¤ê°í˜•ì˜ ë³€ì˜ ìˆ˜, ë‚´ê°ì˜ í•© ê³µì‹ì„ ì‚¬ìš©í•˜ì—¬ ê³„ì‚°í•©ë‹ˆë‹¤.`;
                    tip = 'nê°í˜•ì˜ ë‚´ê°ì˜ í•©ì€ 180 Ã— (n-2)ì…ë‹ˆë‹¤.';
                    break;
                case 'circle_term':
                case 'circle_perimeter':
                case 'sector_area':
                    explanation = `ì›ê³¼ ë¶€ì±„ê¼´ ë¬¸ì œ í’€ì´ì…ë‹ˆë‹¤: ì›ì˜ ë‘˜ë ˆ, ë„“ì´ ê³µì‹ì„ ì‚¬ìš©í•˜ì—¬ ê³„ì‚°í•©ë‹ˆë‹¤.`;
                    tip = 'ì›ì˜ ë‘˜ë ˆëŠ” 2Ï€r, ë„“ì´ëŠ” Ï€rÂ²ì…ë‹ˆë‹¤.';
                    break;
                case '3d_cube':
                case '3d_cylinder':
                case '3d_prism':
                    explanation = `ì…ì²´ë„í˜• ë¬¸ì œ í’€ì´ì…ë‹ˆë‹¤: ë„í˜•ì˜ ë©´, ëª¨ì„œë¦¬, ê¼­ì§“ì ì˜ ìˆ˜ë¥¼ ì •í™•íˆ íŒŒì•…í•´ì•¼ í•©ë‹ˆë‹¤.`;
                    tip = 'ê°ê¸°ë‘¥ì˜ ë©´ì˜ ìˆ˜ëŠ” (ë°‘ë©´ì˜ ë³€ì˜ ìˆ˜ + 2), ëª¨ì„œë¦¬ëŠ” (ë°‘ë©´ì˜ ë³€ì˜ ìˆ˜ Ã— 3)ì…ë‹ˆë‹¤.';
                    break;
                case 'revo_rect':
                case 'revo_semi':
                case 'revo_trapezoid':
                    explanation = `íšŒì „ì²´ ë¬¸ì œ í’€ì´ì…ë‹ˆë‹¤: í‰ë©´ë„í˜•ì„ íšŒì „ì‹œì¼°ì„ ë•Œ ë§Œë“¤ì–´ì§€ëŠ” ì…ì²´ë„í˜•ì„ ìƒìƒí•´ì•¼ í•©ë‹ˆë‹¤.`;
                    tip = 'ì§ì‚¬ê°í˜•ì€ ì›ê¸°ë‘¥, ë°˜ì›ì€ êµ¬, ì§ê°ì‚¼ê°í˜•ì€ ì›ë¿”ì´ ë©ë‹ˆë‹¤.';
                    break;
                case 'stat_mode':
                case 'stat_median':
                case 'stat_mean':
                    explanation = `í†µê³„ ë¬¸ì œ í’€ì´ì…ë‹ˆë‹¤: í‰ê· , ì¤‘ì•™ê°’, ìµœë¹ˆê°’ ë“±ì˜ ìš©ì–´ë¥¼ ì •í™•íˆ ì•Œê³  ê³„ì‚°í•´ì•¼ í•©ë‹ˆë‹¤.`;
                    tip = 'í†µê³„ëŠ” ìë£Œë¥¼ ì •í™•íˆ ì½ê³  ê°œë…ì„ ì ìš©í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.';
                    break;
                default:
                    explanation = `
                        <div class="explanation-step">ë¬¸ì œë¥¼ ë‹¤ì‹œ í•œ ë²ˆ ì°¨ê·¼ì°¨ê·¼ ì½ì–´ë³´ì„¸ìš”.</div>
                        <div class="explanation-step">ê³„ì‚° ê³¼ì •ì„ ë‹¨ê³„ë³„ë¡œ í™•ì¸í•´ë³´ì„¸ìš”.</div>
                        <div class="explanation-step">ë¹„ìŠ·í•œ ë¬¸ì œë¥¼ ë” ë§ì´ ì—°ìŠµí•´ë³´ì„¸ìš”.</div>
                    `;
                    tip = 'ê¸°ë³¸ ê°œë…ì„ ë‹¤ì‹œ ì •ë¦¬í•˜ê³  ì—°ìŠµ ë¬¸ì œë¥¼ ë§ì´ í’€ì–´ë³´ì„¸ìš”.';
            }

            return explanation + `<div class="tip-box">${tip}</div>`;
        }
        
        const userNameInput = document.getElementById('userName');
        const suggestionsDropdown = document.getElementById('suggestionsDropdown');
        
        function saveUserSuggestions() {
            localStorage.setItem('userSuggestions', JSON.stringify(userSuggestions));
        }

        function loadUserSuggestions() {
            const savedSuggestions = localStorage.getItem('userSuggestions');
            if (savedSuggestions) {
                userSuggestions = JSON.parse(savedSuggestions);
            }
        }
        
        function updateSuggestionsDropdown() {
            suggestionsDropdown.innerHTML = '';
            if (userSuggestions.length > 0) {
                suggestionsDropdown.style.display = 'block';
                userSuggestions.forEach(user => {
                    const item = document.createElement('div');
                    item.className = 'suggestion-item';
                    item.innerHTML = `<span class="suggestion-name">${user.name}</span><span class="suggestion-grade">(${user.grade}í•™ë…„)</span><button class="delete-btn">x</button>`;
                    item.onclick = (e) => {
                        if (e.target.className === 'delete-btn') {
                            e.stopPropagation();
                            deleteUserSuggestion(user.name);
                        } else {
                            selectUserSuggestion(user);
                        }
                    };
                    suggestionsDropdown.appendChild(item);
                });
            } else {
                suggestionsDropdown.style.display = 'none';
            }
        }

        function selectUserSuggestion(user) {
            userNameInput.value = user.name;
            document.getElementById('grade').value = user.grade;
            updateGradeDisplay();
            suggestionsDropdown.style.display = 'none';
        }

        function deleteUserSuggestion(name) {
            userSuggestions = userSuggestions.filter(user => user.name !== name);
            saveUserSuggestions();
            updateSuggestionsDropdown();
        }

        userNameInput.addEventListener('focus', () => {
            updateSuggestionsDropdown();
        });

        userNameInput.addEventListener('input', () => {
            const filter = userNameInput.value.toLowerCase();
            const filteredSuggestions = userSuggestions.filter(user => user.name.toLowerCase().includes(filter));
            suggestionsDropdown.innerHTML = '';
            if (filteredSuggestions.length > 0 && filter.length > 0) {
                suggestionsDropdown.style.display = 'block';
                filteredSuggestions.forEach(user => {
                    const item = document.createElement('div');
                    item.className = 'suggestion-item';
                    item.innerHTML = `<span class="suggestion-name">${user.name}</span><span class="suggestion-grade">(${user.grade}í•™ë…„)</span><button class="delete-btn">x</button>`;
                    item.onclick = (e) => {
                        if (e.target.className === 'delete-btn') {
                            e.stopPropagation();
                            deleteUserSuggestion(user.name);
                        } else {
                            selectUserSuggestion(user);
                        }
                    };
                    suggestionsDropdown.appendChild(item);
                });
            } else {
                suggestionsDropdown.style.display = 'none';
            }
        });

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.name-suggestions')) {
                suggestionsDropdown.style.display = 'none';
            }
        });
        
        function updateGradeDisplay() {
            const gradeSelect = document.getElementById('grade');
            const gradeDisplay = document.getElementById('gradeDisplay');
            const selectedOption = gradeSelect.options[gradeSelect.selectedIndex];
            const optgroupLabel = selectedOption.parentElement.label;
            
            gradeDisplay.textContent = `${optgroupLabel} ${selectedOption.textContent}`;
        }
        
        function saveRecord() {
            const userName = document.getElementById('userName').value.trim() || 'ì´ë¦„ ì—†ìŒ';
            const grade = document.getElementById('grade').value;
            const difficulty = document.getElementById('difficulty').value;
            const problemType = document.getElementById('problemType').value;
            const correctCount = score;
            const totalCount = currentQuiz.length;
            const date = new Date().toLocaleDateString('ko-KR');
            
            const newRecord = {
                userName: userName,
                grade: grade,
                difficulty: difficulty,
                problemType: problemType,
                correct: correctCount,
                wrong: totalCount - correctCount,
                date: date
            };
            records.push(newRecord);
            localStorage.setItem('quizRecords', JSON.stringify(records));
            
            const userExists = userSuggestions.some(user => user.name === userName);
            if (!userExists && userName !== 'ì´ë¦„ ì—†ìŒ') {
                userSuggestions.push({ name: userName, grade: grade });
                saveUserSuggestions();
            }
        }
        
        function showRecords() {
            showSection('recordsView');
            
            const recordsContainer = document.getElementById('recordsContainer');
            const savedRecords = localStorage.getItem('quizRecords');
            
            if (savedRecords) {
                records = JSON.parse(savedRecords);
            }
            
            if (records.length === 0) {
                recordsContainer.innerHTML = '<p>ì•„ì§ í€´ì¦ˆ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            recordsContainer.innerHTML = records.map((record, index) => `
                <div class="record-item">
                    <strong>${record.userName}</strong><br>
                    <small>(${getGradeLabel(record.grade)} / ${record.difficulty} / ${record.problemType})</small><br>
                    ì ìˆ˜: ${record.correct}/${record.correct + record.wrong} ì •ë‹µ<br>
                    ë‚ ì§œ: ${record.date}
                </div>
            `).join('');
        }
        
        function getGradeLabel(gradeValue) {
            const gradeSelect = document.getElementById('grade');
            const option = gradeSelect.querySelector(`option[value="${gradeValue}"]`);
            if (option) {
                const optgroupLabel = option.parentElement.label;
                return `${optgroupLabel} ${option.textContent}`;
            }
            return 'ì•Œ ìˆ˜ ì—†ìŒ';
        }

        showMainMenu();
        loadUserSuggestions();
        updateGradeDisplay();
    </script>
</body>
</html>