<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÏàòÌïô ÌÄ¥Ï¶à Ïï±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 40px;
            max-width: 600px;
            width: 100%;
            text-align: center;
        }

        .title {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .menu {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }

        .menu button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .menu button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .quiz-section {
            display: none;
        }

        .quiz-section.active {
            display: block;
        }

        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .name-suggestions {
            position: relative;
        }

        .suggestions-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #ddd;
            border-top: none;
            border-radius: 0 0 10px 10px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .suggestion-item {
            padding: 10px 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
            transition: background-color 0.2s;
        }

        .suggestion-item:hover {
            background-color: #f5f5f5;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-name {
            flex: 1;
        }

        .suggestion-grade {
            font-size: 0.8em;
            color: #666;
            margin-left: 10px;
        }

        .delete-btn {
            background: #ff4757;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }

        .delete-btn:hover {
            background: #ff3742;
        }

        .grade-display {
            font-size: 0.9em;
            color: #667eea;
            font-weight: 500;
            margin-top: 5px;
        }

        .question-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .question {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #333;
        }

        .choices {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .choice-btn {
            background: white;
            border: 2px solid #ddd;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1em;
        }

        .choice-btn:hover {
            border-color: #667eea;
            background: #f0f2ff;
        }

        .choice-btn.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .choice-btn.correct {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        .choice-btn.wrong {
            background: #f44336;
            color: white;
            border-color: #f44336;
        }

        .result {
            background: #e8f5e8;
            border: 2px solid #4CAF50;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            display: none;
        }

        .result.show {
            display: block;
        }

        .explanation-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            display: none;
        }

        .explanation-section.show {
            display: block;
        }

        .explanation-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .explanation-title::before {
            content: "üí°";
            margin-right: 8px;
        }

        .wrong-answer-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .wrong-answer-question {
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }

        .wrong-answer-details {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
        }

        .explanation-content {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 12px;
            border-radius: 0 8px 8px 0;
            margin-top: 10px;
        }

        .explanation-step {
            margin: 8px 0;
            padding-left: 15px;
            position: relative;
        }

        .explanation-step::before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #4caf50;
            font-weight: bold;
        }

        .tip-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 12px;
            margin-top: 10px;
            font-size: 0.9em;
        }

        .tip-box::before {
            content: "üí° ÌåÅ: ";
            font-weight: bold;
            color: #856404;
        }

        .score {
            font-size: 2em;
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 10px;
        }

        .records {
            text-align: left;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .record-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .back-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            margin-top: 20px;
        }

        .back-btn:hover {
            background: #5a6268;
        }

        .center-back-btn {
            background: linear-gradient(45deg, #6c757d, #5a6268);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(108, 117, 125, 0.3);
            margin: 30px auto;
            display: block;
        }

        .center-back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(108, 117, 125, 0.4);
        }

        .next-btn {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
            margin-left: auto;
            margin-top: 20px;
        }

        .next-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.4);
        }

        .quiz-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }

        .setup-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            gap: 20px;
        }

        .start-quiz-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
            flex: 1;
            max-width: 200px;
        }

        .start-quiz-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .progress {
            background: #e0e0e0;
            border-radius: 10px;
            height: 20px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-bar {
            background: linear-gradient(45deg, #667eea, #764ba2);
            height: 100%;
            transition: width 0.3s ease;
        }
        
        .question-image {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e9ecef;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5em;
            font-family: monospace;
            white-space: pre;
            line-height: 1.2;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">üéØ ÏàòÌïô ÌÄ¥Ï¶à Ïï±</h1>
        
        <div id="mainMenu" class="menu">
            <button onclick="startQuiz()">üéÆ ÌÄ¥Ï¶à ÏãúÏûë</button>
            <button onclick="showRecords()">üìã Í∏∞Î°ù Î≥¥Í∏∞</button>
        </div>

        <div id="quizSetup" class="quiz-section">
            <h2>ÌÄ¥Ï¶à ÏÑ§Ï†ï</h2>
            <div class="input-group">
                <label for="userName">Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:</label>
                <div class="name-suggestions">
                    <input type="text" id="userName" placeholder="Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" autocomplete="off">
                    <div class="suggestions-dropdown" id="suggestionsDropdown"></div>
                </div>
            </div>
            <div class="input-group">
                <label for="grade">ÌïôÎÖÑÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî:</label>
                <select id="grade" onchange="updateGradeDisplay()">
                    <optgroup label="Ï¥àÎì±ÌïôÍµê">
                        <option value="1">1ÌïôÎÖÑ</option>
                        <option value="2">2ÌïôÎÖÑ</option>
                        <option value="3" selected>3ÌïôÎÖÑ</option>
                        <option value="4">4ÌïôÎÖÑ</option>
                        <option value="5">5ÌïôÎÖÑ</option>
                        <option value="6">6ÌïôÎÖÑ</option>
                    </optgroup>
                    <optgroup label="Ï§ëÌïôÍµê">
                        <option value="7">1ÌïôÎÖÑ</option>
                        <option value="8">2ÌïôÎÖÑ</option>
                        <option value="9">3ÌïôÎÖÑ</option>
                    </optgroup>
                    <optgroup label="Í≥†Îì±ÌïôÍµê">
                        <option value="10">1ÌïôÎÖÑ</option>
                        <option value="11">2ÌïôÎÖÑ</option>
                        <option value="12">3ÌïôÎÖÑ</option>
                    </optgroup>
                </select>
                <div class="grade-display" id="gradeDisplay"></div>
            </div>
            <div class="input-group">
                <label for="difficulty">ÎÇúÏù¥ÎèÑÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî:</label>
                <select id="difficulty">
                    <option value="Ïâ¨ÏõÄ">Ïâ¨ÏõÄ (Î∞õÏïÑÏò¨Î¶º/ÎÇ¥Î¶º ÏóÜÏùå)</option>
                    <option value="Î≥¥ÌÜµ" selected>Î≥¥ÌÜµ (Î∞õÏïÑÏò¨Î¶º/ÎÇ¥Î¶º 1Î≤à)</option>
                    <option value="Ïñ¥Î†§ÏõÄ">Ïñ¥Î†§ÏõÄ (Î∞õÏïÑÏò¨Î¶º/ÎÇ¥Î¶º Ïó¨Îü¨ Î≤à)</option>
                </select>
            </div>
            <div class="input-group">
                <label for="problemType">Î¨∏Ï†ú Ï¢ÖÎ•òÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî:</label>
                <select id="problemType">
                    <optgroup label="Ï¥àÎì±ÌïôÍµê 3ÌïôÎÖÑ">
                        <option value="ÎçßÏÖà">ÎçßÏÖà</option>
                        <option value="Î∫ÑÏÖà">Î∫ÑÏÖà</option>
                        <option value="ÌòºÌï©" selected>ÌòºÌï© (ÎçßÏÖà, Î∫ÑÏÖà)</option>
                    </optgroup>
                    <optgroup label="Í∏∞Î≥∏ Ïó∞ÏÇ∞">
                        <option value="Í≥±ÏÖà">Í≥±ÏÖà</option>
                        <option value="ÎÇòÎàóÏÖà">ÎÇòÎàóÏÖà</option>
                    </optgroup>
                    <optgroup label="Ï§ëÌïôÍµê 1ÌïôÎÖÑ Í≥ºÏ†ï">
                        <option value="ÏÜåÏù∏ÏàòÎ∂ÑÌï¥">ÏÜåÏù∏ÏàòÎ∂ÑÌï¥</option>
                        <option value="Ï†ïÏàòÏôÄÏú†Î¶¨Ïàò">Ï†ïÏàòÏôÄ Ïú†Î¶¨Ïàò</option>
                        <option value="ÏùºÏ∞®Î∞©Ï†ïÏãù">ÏùºÏ∞®Î∞©Ï†ïÏãù</option>
                        <option value="Ï¢åÌëúÌèâÎ©¥">Ï¢åÌëúÌèâÎ©¥Í≥º Í∑∏ÎûòÌîÑ</option>
                        <option value="ÎπÑÎ°Ä">Ï†ïÎπÑÎ°ÄÏôÄ Î∞òÎπÑÎ°Ä</option>
                        <option value="Í∏∞Î≥∏ÎèÑÌòï">Í∏∞Î≥∏ÎèÑÌòï</option>
                        <option value="Îã§Í∞ÅÌòï">Îã§Í∞ÅÌòï</option>
                        <option value="ÏõêÍ≥ºÎ∂ÄÏ±ÑÍº¥">ÏõêÍ≥º Î∂ÄÏ±ÑÍº¥</option>
                        <option value="ÏûÖÏ≤¥ÎèÑÌòï">ÏûÖÏ≤¥ÎèÑÌòï</option>
                        <option value="ÌöåÏ†ÑÏ≤¥">ÌöåÏ†ÑÏ≤¥</option>
                        <option value="ÌÜµÍ≥Ñ">ÌÜµÍ≥Ñ</option>
                        <option value="Ï§ë1ÌòºÌï©">Ï§ë1 Í≥ºÏ†ï ÌòºÌï©</option>
                    </optgroup>
                </select>
            </div>
            <div class="input-group">
                <label for="problemCount">Î¨∏Ï†ú ÏàòÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî:</label>
                <select id="problemCount">
                    <option value="5">5Î¨∏Ï†ú</option>
                    <option value="10" selected>10Î¨∏Ï†ú</option>
                    <option value="15">15Î¨∏Ï†ú</option>
                    <option value="20">20Î¨∏Ï†ú</option>
                    <option value="30">30Î¨∏Ï†ú</option>
                </select>
            </div>
            <div class="setup-controls">
                <button onclick="showMainMenu()" class="back-btn">Îí§Î°ú Í∞ÄÍ∏∞</button>
                <button onclick="beginQuiz()" class="start-quiz-btn">üéÆ ÌÄ¥Ï¶à ÏãúÏûëÌïòÍ∏∞</button>
            </div>
        </div>

        <div id="quizProgress" class="quiz-section">
            <div class="progress">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <div id="questionCard" class="question-card">
                <div class="question" id="questionText"></div>
                <div id="questionImage" class="question-image" style="display: none;"></div>
                <div class="choices" id="choicesContainer"></div>
            </div>
            <div class="quiz-controls">
                <button onclick="showMainMenu()" class="back-btn">Î©îÏù∏ÏúºÎ°ú</button>
                <button onclick="nextQuestion()" id="nextBtn" class="next-btn" style="display: none;">Îã§Ïùå Î¨∏Ï†ú ‚Üí</button>
            </div>
        </div>

        <div id="quizResult" class="quiz-section">
            <div class="result" id="resultCard">
                <div class="score" id="scoreText"></div>
                <div id="resultMessage"></div>
            </div>
            
            <div class="explanation-section" id="explanationSection">
                <div class="explanation-title">ÌãÄÎ¶∞ Î¨∏Ï†ú Ìï¥ÏÑ§ Î∞è ÌíÄÏù¥ Î∞©Î≤ï</div>
                <div id="wrongAnswersContainer"></div>
            </div>
            
            <button onclick="showMainMenu()" class="center-back-btn">üè† Î©îÏù∏ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞</button>
        </div>

        <div id="recordsView" class="quiz-section">
            <h2>üìã ÌÄ¥Ï¶à Í∏∞Î°ù</h2>
            <div class="records" id="recordsContainer">
                <p>ÏïÑÏßÅ ÌÄ¥Ï¶à Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§.</p>
            </div>
            <button onclick="showMainMenu()" class="back-btn">Îí§Î°ú Í∞ÄÍ∏∞</button>
        </div>
    </div>

    <script>
        const sections = document.querySelectorAll('.quiz-section');
        const mainMenu = document.getElementById('mainMenu');
        const quizSetup = document.getElementById('quizSetup');
        const quizProgress = document.getElementById('quizProgress');
        const quizResult = document.getElementById('quizResult');
        const recordsView = document.getElementById('recordsView');

        const questionText = document.getElementById('questionText');
        const choicesContainer = document.getElementById('choicesContainer');
        const nextBtn = document.getElementById('nextBtn');
        const progressBar = document.getElementById('progressBar');
        const resultCard = document.getElementById('resultCard');
        const scoreText = document.getElementById('scoreText');
        const resultMessage = document.getElementById('resultMessage');
        const explanationSection = document.getElementById('explanationSection');
        const wrongAnswersContainer = document.getElementById('wrongAnswersContainer');
        const questionImage = document.getElementById('questionImage');

        let currentQuiz = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let wrongAnswers = [];
        let records = [];
        let userSuggestions = [];
        let selectedProblemType = '';
        let selectedDifficulty = '';

        const problems = {
            'ÎçßÏÖà': {
                'Ïâ¨ÏõÄ': [
                    { q: '234 + 121', a: '355', type: 'no_carry' },
                    { q: '542 + 231', a: '773', type: 'no_carry' },
                    { q: '172 + 315', a: '487', type: 'no_carry' },
                    { q: '401 + 598', a: '999', type: 'no_carry' },
                    { q: '634 + 324', a: '958', type: 'no_carry' },
                    { q: '121 + 778', a: '899', type: 'no_carry' },
                    { q: '328 + 121', a: '449', type: 'no_carry' },
                ],
                'Î≥¥ÌÜµ': [
                    { q: '343 + 116', a: '459', type: 'one_carry_add' },
                    { q: '284 + 911', a: '1195', type: 'one_carry_add' },
                    { q: '471 + 578', a: '1049', type: 'one_carry_add' },
                    { q: '435 + 363', a: '798', type: 'one_carry_add' },
                    { q: '353 + 368', a: '721', type: 'one_carry_add' },
                    { q: '871 + 273', a: '1144', type: 'one_carry_add' },
                    { q: '963 + 632', a: '1595', type: 'one_carry_add' },
                    { q: '762 + 823', a: '1585', type: 'one_carry_add' },
                    { q: '417 + 683', a: '1100', type: 'one_carry_add' },
                ],
                'Ïñ¥Î†§ÏõÄ': [
                    { q: '428 + 496', a: '924', type: 'multi_carry_add' },
                    { q: '273 + 532', a: '805', type: 'multi_carry_add' },
                    { q: '378 + 373', a: '751', type: 'multi_carry_add' },
                    { q: '834 + 631', a: '1465', type: 'multi_carry_add' },
                    { q: '798 + 698', a: '1496', type: 'multi_carry_add' },
                    { q: '377 + 976', a: '1353', type: 'multi_carry_add' },
                    { q: '911 + 719', a: '1630', type: 'multi_carry_add' },
                    { q: '288 + 845', a: '1133', type: 'multi_carry_add' },
                    { q: '814 + 689', a: '1503', type: 'multi_carry_add' },
                ]
            },
            'Î∫ÑÏÖà': {
                'Ïâ¨ÏõÄ': [
                    { q: '914 - 231', a: '683', type: 'no_borrow' },
                    { q: '896 - 283', a: '613', type: 'no_borrow' },
                    { q: '777 - 154', a: '623', type: 'no_borrow' },
                    { q: '579 - 412', a: '167', type: 'no_borrow' },
                    { q: '898 - 465', a: '433', type: 'no_borrow' },
                    { q: '768 - 257', a: '511', type: 'no_borrow' },
                    { q: '988 - 554', a: '434', type: 'no_borrow' },
                ],
                'Î≥¥ÌÜµ': [
                    { q: '740 - 253', a: '487', type: 'one_borrow' },
                    { q: '679 - 398', a: '281', type: 'one_borrow' },
                    { q: '946 - 795', a: '151', type: 'one_borrow' },
                    { q: '496 - 233', a: '263', type: 'one_borrow' },
                    { q: '904 - 449', a: '455', type: 'one_borrow' },
                    { q: '965 - 718', a: '247', type: 'one_borrow' },
                    { q: '603 - 428', a: '175', type: 'one_borrow' },
                ],
                'Ïñ¥Î†§ÏõÄ': [
                    { q: '343 - 116', a: '227', type: 'multi_borrow' },
                    { q: '748 - 594', a: '154', type: 'multi_borrow' },
                    { q: '677 - 295', a: '382', type: 'multi_borrow' },
                    { q: '990 - 564', a: '426', type: 'multi_borrow' },
                    { q: '861 - 636', a: '225', type: 'multi_borrow' },
                    { q: '852 - 233', a: '619', type: 'multi_borrow' },
                    { q: '934 - 135', a: '799', type: 'multi_borrow' },
                ]
            },
            'Í≥±ÏÖà': {
                'Ïâ¨ÏõÄ': [
                    { q: '12 √ó 3', a: '36', type: 'simple_multi' }, { q: '21 √ó 4', a: '84', type: 'simple_multi' },
                    { q: '15 √ó 5', a: '75', type: 'simple_multi' }, { q: '11 √ó 6', a: '66', type: 'simple_multi' },
                    { q: '24 √ó 2', a: '48', type: 'simple_multi' }, { q: '30 √ó 3', a: '90', type: 'simple_multi' }
                ],
                'Î≥¥ÌÜµ': [
                    { q: '37 √ó 8', a: '296', type: 'one_carry_multi' }, { q: '45 √ó 12', a: '540', type: 'multi_digit_multi' },
                    { q: '64 √ó 9', a: '576', type: 'one_carry_multi' }, { q: '28 √ó 15', a: '420', type: 'multi_digit_multi' },
                    { q: '53 √ó 7', a: '371', type: 'one_carry_multi' }, { q: '18 √ó 22', a: '396', type: 'multi_digit_multi' },
                    { q: '76 √ó 13', a: '988', type: 'multi_digit_multi' }, { q: '88 √ó 9', a: '792', type: 'one_carry_multi' }
                ],
                'Ïñ¥Î†§ÏõÄ': [
                    { q: '123 √ó 45', a: '5535', type: 'complex_multi' }, { q: '245 √ó 18', a: '4410', type: 'complex_multi' },
                    { q: '371 √ó 23', a: '8533', type: 'complex_multi' }, { q: '409 √ó 56', a: '22904', type: 'complex_multi' },
                    { q: '512 √ó 34', a: '17408', type: 'complex_multi' }, { q: '687 √ó 19', a: '13053', type: 'complex_multi' }
                ]
            },
            'ÎÇòÎàóÏÖà': {
                'Ïâ¨ÏõÄ': [
                    { q: '36 √∑ 6', a: '6', type: 'simple_div' }, { q: '81 √∑ 9', a: '9', type: 'simple_div' },
                    { q: '42 √∑ 7', a: '6', type: 'simple_div' }, { q: '25 √∑ 5', a: '5', type: 'simple_div' },
                    { q: '48 √∑ 8', a: '6', type: 'simple_div' }, { q: '54 √∑ 9', a: '6', type: 'simple_div' }
                ],
                'Î≥¥ÌÜµ': [
                    { q: '45 √∑ 3', a: '15', type: 'one_digit_div' }, { q: '72 √∑ 4', a: '18', type: 'one_digit_div' },
                    { q: '65 √∑ 5', a: '13', type: 'one_digit_div' }, { q: '84 √∑ 6', a: '14', type: 'one_digit_div' },
                    { q: '91 √∑ 7', a: '13', type: 'one_digit_div' }, { q: '108 √∑ 9', a: '12', type: 'one_digit_div' }
                ],
                'Ïñ¥Î†§ÏõÄ': [
                    { q: '128 √∑ 4', a: '32', type: 'complex_div' }, { q: '576 √∑ 12', a: '48', type: 'complex_div' },
                    { q: '216 √∑ 8', a: '27', type: 'complex_div' }, { q: '360 √∑ 15', a: '24', type: 'complex_div' },
                    { q: '450 √∑ 18', a: '25', type: 'complex_div' }, { q: '585 √∑ 13', a: '45', type: 'complex_div' }
                ]
            },
            'ÏÜåÏù∏ÏàòÎ∂ÑÌï¥': {
                'Ïâ¨ÏõÄ': [
                    { q: 'ÏÜåÏù∏ÏàòÎ∂ÑÌï¥ÌïòÏÑ∏Ïöî: 12', a: '2^2 √ó 3', type: 'prime_factor' },
                    { q: 'ÏÜåÏù∏ÏàòÎ∂ÑÌï¥ÌïòÏÑ∏Ïöî: 18', a: '2 √ó 3^2', type: 'prime_factor' },
                    { q: 'ÏÜåÏù∏ÏàòÎ∂ÑÌï¥ÌïòÏÑ∏Ïöî: 20', a: '2^2 √ó 5', type: 'prime_factor' }
                ],
                'Î≥¥ÌÜµ': [
                    { q: 'ÏÜåÏù∏ÏàòÎ∂ÑÌï¥ÌïòÏÑ∏Ïöî: 72', a: '2^3 √ó 3^2', type: 'prime_factor' },
                    { q: 'ÏÜåÏù∏ÏàòÎ∂ÑÌï¥ÌïòÏÑ∏Ïöî: 100', a: '2^2 √ó 5^2', type: 'prime_factor' },
                    { q: 'ÏÜåÏù∏ÏàòÎ∂ÑÌï¥ÌïòÏÑ∏Ïöî: 84', a: '2^2 √ó 3 √ó 7', type: 'prime_factor' }
                ],
                'Ïñ¥Î†§ÏõÄ': [
                    { q: 'ÏÜåÏù∏ÏàòÎ∂ÑÌï¥ÌïòÏÑ∏Ïöî: 120', a: '2^3 √ó 3 √ó 5', type: 'prime_factor' },
                    { q: 'ÏÜåÏù∏ÏàòÎ∂ÑÌï¥ÌïòÏÑ∏Ïöî: 144', a: '2^4 √ó 3^2', type: 'prime_factor' },
                    { q: 'ÏÜåÏù∏ÏàòÎ∂ÑÌï¥ÌïòÏÑ∏Ïöî: 216', a: '2^3 √ó 3^3', type: 'prime_factor' }
                ]
            },
            'Ï†ïÏàòÏôÄÏú†Î¶¨Ïàò': {
                'Ïâ¨ÏõÄ': [
                    { q: '(-2) + 5', a: '3', type: 'integer_add' }, { q: '3 - 7', a: '-4', type: 'integer_sub' },
                    { q: '(-1) + (-4)', a: '-5', type: 'integer_add' }, { q: '8 - (-2)', a: '10', type: 'integer_sub' }
                ],
                'Î≥¥ÌÜµ': [
                    { q: '(-3) √ó (-4)', a: '12', type: 'integer_multi' }, { q: '(-10) √∑ 2', a: '-5', type: 'integer_div' },
                    { q: '(-5) √ó 3', a: '-15', type: 'integer_multi' }, { q: '12 √∑ (-4)', a: '-3', type: 'integer_div' }
                ],
                'Ïñ¥Î†§ÏõÄ': [
                    { q: '(-5) + 3 √ó (-2)', a: '-11', type: 'integer_mixed' },
                    { q: '8 - ( -4 ) √∑ 2', a: '10', type: 'integer_mixed' },
                    { q: '(3 - 7) √ó (-2)', a: '8', type: 'integer_mixed' }
                ]
            },
            'ÏùºÏ∞®Î∞©Ï†ïÏãù': {
                'Ïâ¨ÏõÄ': [
                    { q: 'x + 3 = 7', a: '4', type: 'linear_eq' }, { q: '2x = 10', a: '5', type: 'linear_eq' },
                    { q: 'x - 4 = 1', a: '5', type: 'linear_eq' }, { q: 'x/2 = 3', a: '6', type: 'linear_eq' }
                ],
                'Î≥¥ÌÜµ': [
                    { q: '2x - 5 = 11', a: '8', type: 'linear_eq' }, { q: '3(x-1) = 9', a: '4', type: 'linear_eq' },
                    { q: '4x + 2 = 18', a: '4', type: 'linear_eq' }, { q: '5 - 3x = -7', a: '4', type: 'linear_eq' }
                ],
                'Ïñ¥Î†§ÏõÄ': [
                    { q: '0.5x + 1.5 = 4', a: '5', type: 'linear_eq' },
                    { q: '2x - 1 = x + 3', a: '4', type: 'linear_eq' },
                    { q: '1/2x + 1 = 3/2x - 3', a: '4', type: 'linear_eq' }
                ]
            },
            'Ï¢åÌëúÌèâÎ©¥': {
                'Ïâ¨ÏõÄ': [
                    { q: 'Ï†ê (2, 3)ÏùÄ Î™á ÏÇ¨Î∂ÑÎ©¥Ïóê ÏûàÎÇòÏöî?', a: 'Ï†ú1ÏÇ¨Î∂ÑÎ©¥', type: 'quadrant' },
                    { q: 'Ï†ê (-1, -5)ÏùÄ Î™á ÏÇ¨Î∂ÑÎ©¥Ïóê ÏûàÎÇòÏöî?', a: 'Ï†ú3ÏÇ¨Î∂ÑÎ©¥', type: 'quadrant' },
                    { q: 'Ï†ê (-4, 2)ÏùÄ Î™á ÏÇ¨Î∂ÑÎ©¥Ïóê ÏûàÎÇòÏöî?', a: 'Ï†ú2ÏÇ¨Î∂ÑÎ©¥', type: 'quadrant' },
                    { q: 'Ï†ê (5, -3)ÏùÄ Î™á ÏÇ¨Î∂ÑÎ©¥Ïóê ÏûàÎÇòÏöî?', a: 'Ï†ú4ÏÇ¨Î∂ÑÎ©¥', type: 'quadrant' }
                ],
                'Î≥¥ÌÜµ': [
                    { q: 'Ï†ê (x, y)Í∞Ä Ï†ú2ÏÇ¨Î∂ÑÎ©¥Ïóê ÏûàÏùÑ Îïå, xÏôÄ yÏùò Î∂ÄÌò∏Îäî?', a: 'x<0, y>0', type: 'quadrant_sign' },
                    { q: 'Ï†ê (x, y)Í∞Ä Ï†ú4ÏÇ¨Î∂ÑÎ©¥Ïóê ÏûàÏùÑ Îïå, xÏôÄ yÏùò Î∂ÄÌò∏Îäî?', a: 'x>0, y<0', type: 'quadrant_sign' }
                ],
                'Ïñ¥Î†§ÏõÄ': [
                    { q: 'Ï†ê (a,b)Í∞Ä Ï†ú3ÏÇ¨Î∂ÑÎ©¥Ïóê ÏûàÏùÑ Îïå, Ï†ê (-a, -b)Îäî Î™á ÏÇ¨Î∂ÑÎ©¥Ïóê ÏûàÎÇòÏöî?', a: 'Ï†ú1ÏÇ¨Î∂ÑÎ©¥', type: 'quadrant_advanced' }
                ]
            },
            'ÎπÑÎ°Ä': {
                'Ïâ¨ÏõÄ': [
                    { q: 'yÍ∞Ä xÏóê Ï†ïÎπÑÎ°ÄÌïòÍ≥† x=2Ïùº Îïå y=4ÏûÖÎãàÎã§. x=5Ïùº Îïå yÏùò Í∞íÏùÄ?', a: '10', type: 'direct_prop' },
                    { q: 'yÍ∞Ä xÏóê Î∞òÎπÑÎ°ÄÌïòÍ≥† x=2Ïùº Îïå y=4ÏûÖÎãàÎã§. x=8Ïùº Îïå yÏùò Í∞íÏùÄ?', a: '1', type: 'inverse_prop' }
                ],
                'Î≥¥ÌÜµ': [
                    { q: 'Ï†ïÎπÑÎ°Ä Í¥ÄÍ≥Ñ y=axÏùò Í∑∏ÎûòÌîÑÍ∞Ä Ï†ê (3, 6)ÏùÑ ÏßÄÎÇ† Îïå, aÏùò Í∞íÏùÄ?', a: '2', type: 'direct_prop_eq' },
                    { q: 'Î∞òÎπÑÎ°Ä Í¥ÄÍ≥Ñ y=a/xÏùò Í∑∏ÎûòÌîÑÍ∞Ä Ï†ê (3, 4)Î•º ÏßÄÎÇ† Îïå, aÏùò Í∞íÏùÄ?', a: '12', type: 'inverse_prop_eq' }
                ],
                'Ïñ¥Î†§ÏõÄ': [
                    { q: 'yÍ∞Ä xÏóê Î∞òÎπÑÎ°ÄÌïòÍ≥† x=6Ïùº Îïå y=-2ÏûÖÎãàÎã§. x=-4Ïùº Îïå yÏùò Í∞íÏùÄ?', a: '3', type: 'inverse_prop_advanced' }
                ]
            },
            'Í∏∞Î≥∏ÎèÑÌòï': {
                'Ïâ¨ÏõÄ': [
                    { q: 'Ï†êÏù¥ Î™®Ïó¨ÏÑú ÎßåÎì§Ïñ¥ÏßÄÎäî ÎèÑÌòïÏùÄ?', a: 'ÏÑ†', type: 'geo_line' },
                    { q: 'Îëê Î∞òÏßÅÏÑ†Ïù¥ Ïù¥Î£®Îäî ÎèÑÌòïÏùÄ?', a: 'Í∞Å', type: 'geo_angle' }
                ],
                'Î≥¥ÌÜµ': [
                    { q: 'ÏÑúÎ°ú Îã§Î•∏ Îëê ÏßÅÏÑ†Ïù¥ Ìïú Ï†êÏóêÏÑú ÎßåÎÇ† Îïå, Í∑∏ Ï†êÏùÑ Î¨¥ÏóáÏù¥Îùº ÌïòÎÇòÏöî?', a: 'ÍµêÏ†ê', type: 'geo_intersect' },
                    { q: 'Î©¥Í≥º Î©¥Ïù¥ ÎßåÎÇòÏÑú ÏÉùÍ∏∞Îäî ÏÑ†ÏùÄ?', a: 'ÍµêÏÑ†', type: 'geo_intersect' }
                ],
                'Ïñ¥Î†§ÏõÄ': [
                    { q: 'ÏÑúÎ°ú Îã§Î•∏ ÏÑ∏ ÏßÅÏÑ† l, m, nÏù¥ Ìïú Ï†êÏóêÏÑú ÎßåÎÇ† Îïå, ÍµêÏ†êÏùò ÏàòÎäî?', a: '1', type: 'geo_intersect_advanced' }
                ]
            },
            'Îã§Í∞ÅÌòï': {
                'Ïâ¨ÏõÄ': [
                    { q: 'Î≥ÄÏù¥ 3Í∞úÏù∏ Îã§Í∞ÅÌòïÏùÄ?', a: 'ÏÇºÍ∞ÅÌòï', type: 'polygon_count' },
                    { q: 'Î≥ÄÏù¥ 4Í∞úÏù∏ Îã§Í∞ÅÌòïÏùÄ?', a: 'ÏÇ¨Í∞ÅÌòï', type: 'polygon_count' }
                ],
                'Î≥¥ÌÜµ': [
                    { q: 'ÎÇ¥Í∞ÅÏùò Ìï©Ïù¥ 180ÎèÑÏù∏ ÎèÑÌòïÏùÄ?', a: 'ÏÇºÍ∞ÅÌòï', type: 'polygon_sum' },
                    { q: 'Ï†ïÏò§Í∞ÅÌòïÏùò Ìïú Ïô∏Í∞ÅÏùò ÌÅ¨Í∏∞Îäî?', a: '72', type: 'polygon_angle' }
                ],
                'Ïñ¥Î†§ÏõÄ': [
                    { q: 'Ï†ïÏú°Í∞ÅÌòïÏùò Ìïú ÎÇ¥Í∞ÅÏùò ÌÅ¨Í∏∞Îäî?', a: '120', type: 'polygon_angle' },
                    { q: 'ÎåÄÍ∞ÅÏÑ†Ïùò ÏàòÍ∞Ä 9Í∞úÏù∏ Îã§Í∞ÅÌòïÏùÄ?', a: 'Ïú°Í∞ÅÌòï', type: 'polygon_diagonal' }
                ]
            },
            'ÏõêÍ≥ºÎ∂ÄÏ±ÑÍº¥': {
                'Ïâ¨ÏõÄ': [
                    { q: 'ÏõêÏùò Ï§ëÏã¨ÏùÑ ÏßÄÎÇòÎäî Í∞ÄÏû• Í∏¥ ÌòÑÏùÄ?', a: 'ÏßÄÎ¶Ñ', type: 'circle_term' },
                    { q: 'ÏõêÏùò ÎëòÎ†àÎ•º Î¨¥ÏóáÏù¥ÎùºÍ≥† ÌïòÎÇòÏöî?', a: 'ÏõêÏ£º', type: 'circle_term' }
                ],
                'Î≥¥ÌÜµ': [
                    { q: 'Î∞òÏßÄÎ¶ÑÏù¥ 5cmÏù∏ ÏõêÏùò ÎëòÎ†àÎäî?', a: '10œÄ', type: 'circle_perimeter' },
                    { q: 'Î∞òÏßÄÎ¶ÑÏù¥ 4cmÏù∏ ÏõêÏùò ÎÑìÏù¥Îäî?', a: '16œÄ', type: 'circle_area' }
                ],
                'Ïñ¥Î†§ÏõÄ': [
                    { q: 'Ï§ëÏã¨Í∞ÅÏù¥ 90ÎèÑÏù¥Í≥† Î∞òÏßÄÎ¶ÑÏù¥ 4cmÏù∏ Î∂ÄÏ±ÑÍº¥Ïùò ÎÑìÏù¥Îäî?', a: '4œÄ', type: 'sector_area' },
                    { q: 'Ìò∏Ïùò Í∏∏Ïù¥Í∞Ä 3œÄÏù¥Í≥† Î∞òÏßÄÎ¶ÑÏù¥ 6cmÏù∏ Î∂ÄÏ±ÑÍº¥Ïùò ÎÑìÏù¥Îäî?', a: '9œÄ', type: 'sector_area_arc' }
                ]
            },
            'ÏûÖÏ≤¥ÎèÑÌòï': {
                'Ïâ¨ÏõÄ': [
                    { q: 'Ï†ïÏú°Î©¥Ï≤¥Ïùò Íº≠ÏßìÏ†êÏùò ÏàòÎäî?', a: '8', type: '3d_cube' },
                    { q: 'Î∞ëÎ©¥Ïù¥ ÏõêÏù∏ Í∏∞Îë•ÏùÄ?', a: 'ÏõêÍ∏∞Îë•', type: '3d_cylinder' }
                ],
                'Î≥¥ÌÜµ': [
                    { q: 'Î∞ëÎ©¥Ïùò Î™®ÏñëÏù¥ ÏÇ¨Í∞ÅÌòïÏù∏ Í∞ÅÍ∏∞Îë•Ïùò Î©¥Ïùò ÏàòÎäî?', a: '6', type: '3d_prism' },
                    { q: 'ÏÇºÍ∞ÅÎøîÏùò Î™®ÏÑúÎ¶¨Ïùò ÏàòÎäî?', a: '6', type: '3d_pyramid' }
                ],
                'Ïñ¥Î†§ÏõÄ': [
                    { q: 'Ïò§Í∞ÅÎøîÎåÄÏùò Î©¥Ïùò ÏàòÎäî?', a: '7', type: '3d_frustum' }
                ]
            },
            'ÌöåÏ†ÑÏ≤¥': {
                'Ïâ¨ÏõÄ': [
                    { q: 'ÏßÅÏÇ¨Í∞ÅÌòïÏùÑ Ìïú Î≥ÄÏùÑ Ï∂ïÏúºÎ°ú ÌöåÏ†ÑÏãúÏºú ÏñªÎäî ÎèÑÌòïÏùÄ?', a: 'ÏõêÍ∏∞Îë•', type: 'revo_rect' },
                    { q: 'Î∞òÏõêÏùÑ ÏßÄÎ¶ÑÏùÑ Ï∂ïÏúºÎ°ú ÌöåÏ†ÑÏãúÏºú ÏñªÎäî ÎèÑÌòïÏùÄ?', a: 'Íµ¨', type: 'revo_semi' }
                ],
                'Î≥¥ÌÜµ': [
                    { q: 'ÏßÅÍ∞ÅÏÇºÍ∞ÅÌòïÏùÑ Ìïú Î≥ÄÏùÑ Ï∂ïÏúºÎ°ú ÌöåÏ†ÑÏãúÏºú ÏñªÎäî ÎèÑÌòïÏùÄ?', a: 'ÏõêÎøî', type: 'revo_tri' },
                    { q: 'ÏÇ¨Îã§Î¶¨Íº¥ÏùÑ Ìïú Î≥ÄÏùÑ Ï∂ïÏúºÎ°ú ÌöåÏ†ÑÏãúÏºú ÏñªÎäî ÎèÑÌòïÏùÄ?', a: 'ÏõêÎøîÎåÄ', type: 'revo_trapezoid' }
                ],
                'Ïñ¥Î†§ÏõÄ': [
                    { q: 'Îã§Ïùå Ï§ë ÌöåÏ†ÑÏ≤¥Í∞Ä ÏïÑÎãå Í≤ÉÏùÄ?', a: 'ÏÇºÍ∞ÅÎøî', type: 'revo_not' }
                ]
            },
            'ÌÜµÍ≥Ñ': {
                'Ïâ¨ÏõÄ': [
                    { q: 'Í∞ÄÏû• ÏûêÏ£º ÎÇòÏò§Îäî Í∞íÏùÑ Î¨¥ÏóáÏù¥Îùº ÌïòÎÇòÏöî?', a: 'ÏµúÎπàÍ∞í', type: 'stat_mode' },
                    { q: 'ÏûêÎ£åÎ•º ÌÅ¨Í∏∞ ÏàúÏúºÎ°ú ÎÇòÏó¥ÌñàÏùÑ Îïå ÌïúÍ∞ÄÏö¥Îç∞ ÏûàÎäî Í∞íÏùÄ?', a: 'Ï§ëÏïôÍ∞í', type: 'stat_median' }
                ],
                'Î≥¥ÌÜµ': [
                    { q: '1, 2, 3, 4, 5Ïùò ÌèâÍ∑†ÏùÄ?', a: '3', type: 'stat_mean' },
                    { q: '1, 2, 2, 3, 4Ïùò ÏµúÎπàÍ∞íÏùÄ?', a: '2', type: 'stat_mode' }
                ],
                'Ïñ¥Î†§ÏõÄ': [
                    { q: 'Ìé∏Ï∞®Ïùò Ï†úÍ≥±Ïùò ÌèâÍ∑†ÏùÑ Î¨¥ÏóáÏù¥ÎùºÍ≥† ÌïòÎÇòÏöî?', a: 'Î∂ÑÏÇ∞', type: 'stat_variance' }
                ]
            }
        };

        function showSection(sectionId) {
            sections.forEach(section => {
                if (section.id === sectionId) {
                    section.classList.add('active');
                } else {
                    section.classList.remove('active');
                }
            });
        }

        function showMainMenu() {
            showSection('mainMenu');
        }

        function startQuiz() {
            showSection('quizSetup');
            document.getElementById('grade').value = "3";
            document.getElementById('problemType').value = "ÌòºÌï©";
            document.getElementById('problemCount').value = "10";
            updateGradeDisplay();
        }

        function beginQuiz() {
            const problemCount = parseInt(document.getElementById('problemCount').value);
            selectedDifficulty = document.getElementById('difficulty').value;
            selectedProblemType = document.getElementById('problemType').value;
            const userName = document.getElementById('userName').value.trim() || 'Ïù¥Î¶Ñ ÏóÜÏùå';
            const grade = document.getElementById('grade').value;

            score = 0;
            currentQuestionIndex = 0;
            wrongAnswers = [];
            
            currentQuiz = generateQuiz(problemCount, selectedProblemType, selectedDifficulty);

            if (currentQuiz.length === 0) {
                alert('ÏÑ†ÌÉùÌïòÏã† Ï°∞Í±¥Ïóê ÎßûÎäî Î¨∏Ï†úÍ∞Ä ÏóÜÏäµÎãàÎã§. Îã§Î•∏ ÏÑ§Ï†ïÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                showMainMenu();
                return;
            }

            showSection('quizProgress');
            nextBtn.style.display = 'none';
            displayQuestion();
        }
        
        function generateQuiz(count, problemType, difficulty) {
            let pool = [];

            if (problemType === 'ÌòºÌï©') {
                const addPool = problems['ÎçßÏÖà'][difficulty] || [];
                const subPool = problems['Î∫ÑÏÖà'][difficulty] || [];
                pool = [...addPool, ...subPool];
            } else if (problems[problemType] && problems[problemType][difficulty]) {
                pool = problems[problemType][difficulty];
            }

            // Î¨∏Ï†ú ÌíÄÏù¥ Ï∂©Î∂ÑÌïòÏßÄ ÏïäÏúºÎ©¥ Ï°¥Ïû¨ÌïòÎäî Î¨∏Ï†úÎßå Î∞òÌôò
            if (pool.length < count) {
                alert(`ÏÑ†ÌÉùÌïòÏã† ÎÇúÏù¥ÎèÑÏôÄ Î¨∏Ï†ú Ïú†ÌòïÏóêÎäî ${count}Î¨∏Ï†úÍ∞Ä ÏóÜÏäµÎãàÎã§. Ï°¥Ïû¨ÌïòÎäî Î™®Îì† ${pool.length}Î¨∏Ï†úÎ•º Ï∂úÏ†úÌï©ÎãàÎã§.`);
            }

            const shuffledPool = shuffleArray(pool);
            return shuffledPool.slice(0, count);
        }

        function generateChoices(answer, problemType) {
            const choices = [answer];
            while (choices.length < 4) {
                let wrongAnswer;
                const problemTypesWithFixedAnswers = ['Ï¢åÌëúÌèâÎ©¥', 'Í∏∞Î≥∏ÎèÑÌòï', 'Îã§Í∞ÅÌòï', 'ÏõêÍ≥ºÎ∂ÄÏ±ÑÍº¥', 'ÏûÖÏ≤¥ÎèÑÌòï', 'ÌöåÏ†ÑÏ≤¥', 'ÌÜµÍ≥Ñ'];
                
                if (problemTypesWithFixedAnswers.includes(problemType)) {
                     // Î¨∏ÏûêÏó¥ Í∏∞Î∞ò Î¨∏Ï†úÏùò Ïò§Îãµ ÏÉùÏÑ±
                     const wrongOptions = {
                        'Ï¢åÌëúÌèâÎ©¥': ['Ï†ú1ÏÇ¨Î∂ÑÎ©¥', 'Ï†ú2ÏÇ¨Î∂ÑÎ©¥', 'Ï†ú3ÏÇ¨Î∂ÑÎ©¥', 'Ï†ú4ÏÇ¨Î∂ÑÎ©¥', 'xÏ∂ï', 'yÏ∂ï'],
                        'Í∏∞Î≥∏ÎèÑÌòï': ['Ï†ê', 'ÏÑ†', 'Î©¥', 'Í∞Å', 'ÍµêÏ†ê', 'ÍµêÏÑ†'],
                        'Îã§Í∞ÅÌòï': ['ÏÇºÍ∞ÅÌòï', 'ÏÇ¨Í∞ÅÌòï', 'Ïò§Í∞ÅÌòï', 'Ïú°Í∞ÅÌòï', 'Ïπ†Í∞ÅÌòï'],
                        'ÏõêÍ≥ºÎ∂ÄÏ±ÑÍº¥': ['ÌòÑ', 'Ìò∏', 'Î∞òÏßÄÎ¶Ñ', 'ÏßÄÎ¶Ñ', 'ÏõêÏ£º', 'Ï§ëÏã¨Í∞Å', 'Î∂ÄÏ±ÑÍº¥'],
                        'ÏûÖÏ≤¥ÎèÑÌòï': ['Ï†ïÏú°Î©¥Ï≤¥', 'ÏõêÍ∏∞Îë•', 'ÏõêÎøî', 'Íµ¨', 'Í∞ÅÍ∏∞Îë•', 'Í∞ÅÎøî'],
                        'ÌöåÏ†ÑÏ≤¥': ['ÏõêÎøî', 'ÏõêÍ∏∞Îë•', 'Íµ¨', 'ÏõêÎøîÎåÄ', 'Ïõê'],
                        'ÌÜµÍ≥Ñ': ['ÌèâÍ∑†', 'Ï§ëÏïôÍ∞í', 'ÏµúÎπàÍ∞í', 'Î∂ÑÏÇ∞', 'ÌëúÏ§ÄÌé∏Ï∞®'],
                    };
                    const potentialWrongs = wrongOptions[problemType] || [];
                    if (potentialWrongs.length > 0) {
                        wrongAnswer = potentialWrongs[Math.floor(Math.random() * potentialWrongs.length)];
                    } else {
                        wrongAnswer = 'Ïò§Îãµ';
                    }
                } else {
                     // Ïà´Ïûê Í∏∞Î∞ò Î¨∏Ï†úÏùò Ïò§Îãµ ÏÉùÏÑ±
                     wrongAnswer = (parseInt(answer) + Math.floor(Math.random() * 20) - 10).toString();
                }
                
                if (!choices.includes(wrongAnswer)) {
                    choices.push(wrongAnswer);
                }
            }
            return shuffleArray(choices);
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function displayQuestion() {
            if (currentQuestionIndex < currentQuiz.length) {
                const question = currentQuiz[currentQuestionIndex];
                questionText.textContent = question.q;
                choicesContainer.innerHTML = '';
                questionImage.style.display = 'none';
                
                if (question.image) {
                    questionImage.innerHTML = question.image;
                    questionImage.style.display = 'flex';
                }

                question.choices = generateChoices(question.a, selectedProblemType);

                question.choices.forEach(choice => {
                    const button = document.createElement('button');
                    button.textContent = choice;
                    button.className = 'choice-btn';
                    button.onclick = () => checkAnswer(button, choice, question);
                    choicesContainer.appendChild(button);
                });

                updateProgressBar();
            } else {
                showResult();
            }
        }

        function checkAnswer(button, selectedChoice, question) {
            const isCorrect = (selectedChoice.toString() === question.a);
            const allChoiceBtns = choicesContainer.querySelectorAll('.choice-btn');

            allChoiceBtns.forEach(btn => {
                btn.disabled = true;
                if (btn.textContent.toString() === question.a) {
                    btn.classList.add('correct');
                } else if (btn === button) {
                    btn.classList.add('wrong');
                }
            });

            if (isCorrect) {
                score++;
            } else {
                wrongAnswers.push(question);
            }

            nextBtn.style.display = 'block';
        }

        function nextQuestion() {
            currentQuestionIndex++;
            nextBtn.style.display = 'none';
            displayQuestion();
        }

        function updateProgressBar() {
            const progress = (currentQuestionIndex / currentQuiz.length) * 100;
            progressBar.style.width = `${progress}%`;
        }

        function showResult() {
            showSection('quizResult');
            updateProgressBar();

            const totalQuestions = currentQuiz.length;
            const percentage = (score / totalQuestions) * 100;

            scoreText.textContent = `${score} / ${totalQuestions} Î¨∏Ï†ú Ï†ïÎãµ!`;
            if (percentage >= 80) {
                resultMessage.textContent = 'üéâ ÌõåÎ•≠Ìï©ÎãàÎã§! ÏïÑÏ£º ÏûòÌñàÏñ¥Ïöî!';
                resultCard.style.backgroundColor = '#e8f5e8';
                resultCard.style.borderColor = '#4CAF50';
            } else if (percentage >= 50) {
                resultMessage.textContent = 'üëç ÏûòÌñàÏäµÎãàÎã§! Ï°∞Í∏àÎßå Îçî ÎÖ∏Î†•Ìï¥ Î¥êÏöî!';
                resultCard.style.backgroundColor = '#fff8e1';
                resultCard.style.borderColor = '#ffc107';
            } else {
                resultMessage.textContent = 'üí™ ÌûòÎÇ¥ÏÑ∏Ïöî! Îã§Ïãú ÌïúÎ≤à ÎèÑÏ†ÑÌï¥ Î≥¥ÏÑ∏Ïöî!';
                resultCard.style.backgroundColor = '#ffebee';
                resultCard.style.borderColor = '#f44336';
            }
            resultCard.style.display = 'block';

            if (wrongAnswers.length > 0) {
                explanationSection.classList.add('show');
                displayWrongAnswers();
            } else {
                explanationSection.classList.remove('show');
            }
            saveRecord();
        }

        function displayWrongAnswers() {
            wrongAnswersContainer.innerHTML = '';
            wrongAnswers.forEach(wrongQ => {
                const wrongItem = document.createElement('div');
                wrongItem.className = 'wrong-answer-item';
                wrongItem.innerHTML = `
                    <div class="wrong-answer-question">Î¨∏Ï†ú: ${wrongQ.q}</div>
                    <div class="wrong-answer-details">Ï†ïÎãµ: ${wrongQ.a}</div>
                    <div class="explanation-content">${getExplanation(wrongQ.type, wrongQ.q, wrongQ.a)}</div>
                `;
                wrongAnswersContainer.appendChild(wrongItem);
            });
        }

        function getExplanation(type, question, answer) {
            let explanation = '';
            let tip = '';
            
            // Í≥µÌÜµ Î≥ÄÏàò
            const [num1, num2] = question.replace(/ /g, '').split(/[+-√ó√∑=]/).map(Number).filter(n => !isNaN(n));
            const operator = question.match(/[+√ó√∑=-]/) ? question.match(/[+√ó√∑=-]/)[0] : '';
            
            switch(type) {
                case 'no_carry':
                case 'one_carry_add':
                case 'multi_carry_add':
                    explanation = `ÎçßÏÖà Î¨∏Ï†ú ÌíÄÏù¥ÏûÖÎãàÎã§: Í∞Å ÏûêÎ¶¨Ïùò Ïà´ÏûêÎ•º ÎçîÌïòÍ≥†, 10Ïù¥ ÎÑòÏúºÎ©¥ Îã§Ïùå ÏûêÎ¶¨Î°ú Î∞õÏïÑÏò¨Î¶ºÌï©ÎãàÎã§.`;
                    tip = 'Î∞õÏïÑÏò¨Î¶ºÏùÑ Ï†ïÌôïÌïòÍ≤å ÌïòÎäî Í≤ÉÏù¥ Ï§ëÏöîÌï©ÎãàÎã§.';
                    break;
                case 'no_borrow':
                case 'one_borrow':
                case 'multi_borrow':
                    explanation = `Î∫ÑÏÖà Î¨∏Ï†ú ÌíÄÏù¥ÏûÖÎãàÎã§: Í∞Å ÏûêÎ¶¨Ïùò Ïà´ÏûêÎ•º ÎπºÍ≥†, Î∂ÄÏ°±ÌïòÎ©¥ ÏúóÏûêÎ¶¨ÏóêÏÑú 10ÏùÑ Î∞õÏïÑÎÇ¥Î¶ºÌï©ÎãàÎã§.`;
                    tip = 'Î∞õÏïÑÎÇ¥Î¶ºÏùÑ Ï†ïÌôïÌïòÍ≤å ÌïòÎäî Í≤ÉÏù¥ Ï§ëÏöîÌï©ÎãàÎã§.';
                    break;
                case 'simple_multi':
                case 'one_carry_multi':
                case 'multi_digit_multi':
                case 'complex_multi':
                    explanation = `Í≥±ÏÖà Î¨∏Ï†ú ÌíÄÏù¥ÏûÖÎãàÎã§: Í∞Å ÏûêÎ¶¨Ïóê Îî∞Îùº Í≥±Ìïú ÌõÑ, ÎçîÌï¥ÏÑú ÏµúÏ¢Ö Í≤∞Í≥ºÎ•º Íµ¨Ìï©ÎãàÎã§.`;
                    tip = 'ÏûêÎ¶¨ÏàòÏóê ÎßûÏ∂∞ Í≥±ÏÖàÏùÑ ÌïòÍ≥†, ÎçîÌï† Îïå ÏûêÎ¶øÏàòÎ•º Ïûò ÎßûÏ∂∞Ïïº Ìï©ÎãàÎã§.';
                    break;
                case 'simple_div':
                case 'one_digit_div':
                case 'complex_div':
                    explanation = `ÎÇòÎàóÏÖà Î¨∏Ï†ú ÌíÄÏù¥ÏûÖÎãàÎã§: ÎÇòÎàÑÎäî ÏàòÎ°ú ÎÇòÎàÑÏñ¥ÏßÄÎäî ÏàòÎ•º Î™á Î≤à Î∫Ñ Ïàò ÏûàÎäîÏßÄ ÏÉùÍ∞ÅÌïòÎ©∞ Î™´ÏùÑ Íµ¨Ìï©ÎãàÎã§.`;
                    tip = 'ÎÇòÎàÑÎäî ÏàòÏôÄ Í∞ÄÍπåÏö¥ Í≥±ÏÖà Í∞íÏùÑ Ï∞æÏïÑÎ≥¥Îäî Í≤ÉÏù¥ Ï¢ãÏäµÎãàÎã§.';
                    break;
                case 'prime_factor':
                    explanation = `ÏÜåÏù∏ÏàòÎ∂ÑÌï¥ ÌíÄÏù¥ÏûÖÎãàÎã§: Ï£ºÏñ¥ÏßÑ ÏàòÎ•º ÏÜåÏàòÏù∏ Ïù∏ÏàòÎì§Ïùò Í≥±ÏúºÎ°ú ÎÇòÌÉÄÎÉÖÎãàÎã§.`;
                    tip = 'Í∞ÄÏû• ÏûëÏùÄ ÏÜåÏàòÎ∂ÄÌÑ∞ Ï∞®Î°ÄÎåÄÎ°ú ÎÇòÎàÑÏñ¥Î≥¥Îäî Í≤ÉÏù¥ Ï¢ãÏäµÎãàÎã§.';
                    break;
                case 'integer_add':
                case 'integer_sub':
                case 'integer_multi':
                case 'integer_div':
                case 'integer_mixed':
                    explanation = `Ï†ïÏàòÏôÄ Ïú†Î¶¨Ïàò Ïó∞ÏÇ∞ ÌíÄÏù¥ÏûÖÎãàÎã§: Î∂ÄÌò∏Ïóê Ï£ºÏùòÌïòÎ©∞ Í≥ÑÏÇ∞Ìï©ÎãàÎã§. Í≥±ÏÖà/ÎÇòÎàóÏÖàÏóêÏÑúÎäî Í∞ôÏùÄ Î∂ÄÌò∏Îäî ÏñëÏàò, Îã§Î•∏ Î∂ÄÌò∏Îäî ÏùåÏàòÍ∞Ä Îê©ÎãàÎã§.`;
                    tip = 'Î∂ÄÌò∏Î•º Î®ºÏ†Ä Í≤∞Ï†ïÌïòÍ≥†, Ï†àÎåìÍ∞íÎÅºÎ¶¨ Í≥ÑÏÇ∞ÌïòÎäî Í≤ÉÏù¥ Ï¢ãÏäµÎãàÎã§.';
                    break;
                case 'linear_eq':
                    explanation = `ÏùºÏ∞®Î∞©Ï†ïÏãù ÌíÄÏù¥ÏûÖÎãàÎã§: xÎ•º ÌïúÏ™ΩÏóê ÎÇ®Í∏∞ÎèÑÎ°ù Ïù¥Ìï≠ÌïòÍ±∞ÎÇò ÏñëÎ≥ÄÏùÑ Í∞ôÏùÄ ÏàòÎ°ú ÎÇòÎàÑÏñ¥ xÏùò Í∞íÏùÑ Íµ¨Ìï©ÎãàÎã§.`;
                    tip = 'Ï¢åÎ≥ÄÏóêÎäî xÎ•º Ìè¨Ìï®Ìïú Ìï≠, Ïö∞Î≥ÄÏóêÎäî ÏÉÅÏàòÌï≠ÏùÑ Î™®ÏúºÎäî Í≤ÉÏù¥ Í∏∞Î≥∏ÏûÖÎãàÎã§.';
                    break;
                case 'quadrant':
                case 'quadrant_sign':
                    explanation = `Ï¢åÌëúÌèâÎ©¥ ÌíÄÏù¥ÏûÖÎãàÎã§: xÏ∂ïÍ≥º yÏ∂ïÏùò Î∂ÄÌò∏Î•º Í∏∞Ï§ÄÏúºÎ°ú ÏÇ¨Î∂ÑÎ©¥ÏùÑ ÌåêÎã®Ìï©ÎãàÎã§.`;
                    tip = 'Ï†ú1ÏÇ¨Î∂ÑÎ©¥(+, +), Ï†ú2ÏÇ¨Î∂ÑÎ©¥(-, +), Ï†ú3ÏÇ¨Î∂ÑÎ©¥(-, -), Ï†ú4ÏÇ¨Î∂ÑÎ©¥(+, -)ÏùÑ Í∏∞ÏñµÌïòÏÑ∏Ïöî.';
                    break;
                case 'direct_prop':
                case 'inverse_prop':
                case 'direct_prop_eq':
                    explanation = `ÎπÑÎ°Ä Í¥ÄÍ≥Ñ ÌíÄÏù¥ÏûÖÎãàÎã§: Ï†ïÎπÑÎ°ÄÎäî y=ax, Î∞òÎπÑÎ°ÄÎäî y=a/x Í≥µÏãùÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ Î¨∏Ï†úÎ•º Ìï¥Í≤∞Ìï©ÎãàÎã§.`;
                    tip = 'Îëê Î≥ÄÏàò ÏÇ¨Ïù¥Ïùò Í¥ÄÍ≥ÑÏãùÏùÑ Ï†ïÌôïÌûà ÌååÏïÖÌïòÎäî Í≤ÉÏù¥ ÌïµÏã¨ÏûÖÎãàÎã§.';
                    break;
                case 'geo_line':
                case 'geo_angle':
                case 'geo_intersect':
                    explanation = `Í∏∞Î≥∏ ÎèÑÌòï ÌíÄÏù¥ÏûÖÎãàÎã§: Ï†ê, ÏÑ†, Î©¥Ïùò Ï†ïÏùòÏôÄ Í¥ÄÍ≥ÑÎ•º Ïù¥Ìï¥Ìï¥Ïïº Ìï©ÎãàÎã§.`;
                    tip = 'ÎèÑÌòïÏùò Í∏∞Î≥∏ Í∞úÎÖêÍ≥º Ïö©Ïñ¥Î•º Îã§Ïãú ÌïúÎ≤à ÌôïÏù∏Ìï¥Î≥¥ÏÑ∏Ïöî.';
                    break;
                case 'polygon_count':
                case 'polygon_sum':
                case 'polygon_angle':
                    explanation = `Îã§Í∞ÅÌòï Î¨∏Ï†ú ÌíÄÏù¥ÏûÖÎãàÎã§: Îã§Í∞ÅÌòïÏùò Î≥ÄÏùò Ïàò, ÎÇ¥Í∞ÅÏùò Ìï© Í≥µÏãùÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ Í≥ÑÏÇ∞Ìï©ÎãàÎã§.`;
                    tip = 'nÍ∞ÅÌòïÏùò ÎÇ¥Í∞ÅÏùò Ìï©ÏùÄ 180 √ó (n-2)ÏûÖÎãàÎã§.';
                    break;
                case 'circle_term':
                case 'circle_perimeter':
                case 'sector_area':
                    explanation = `ÏõêÍ≥º Î∂ÄÏ±ÑÍº¥ Î¨∏Ï†ú ÌíÄÏù¥ÏûÖÎãàÎã§: ÏõêÏùò ÎëòÎ†à, ÎÑìÏù¥ Í≥µÏãùÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ Í≥ÑÏÇ∞Ìï©ÎãàÎã§.`;
                    tip = 'ÏõêÏùò ÎëòÎ†àÎäî 2œÄr, ÎÑìÏù¥Îäî œÄr¬≤ÏûÖÎãàÎã§.';
                    break;
                case '3d_cube':
                case '3d_cylinder':
                case '3d_prism':
                    explanation = `ÏûÖÏ≤¥ÎèÑÌòï Î¨∏Ï†ú ÌíÄÏù¥ÏûÖÎãàÎã§: ÎèÑÌòïÏùò Î©¥, Î™®ÏÑúÎ¶¨, Íº≠ÏßìÏ†êÏùò ÏàòÎ•º Ï†ïÌôïÌûà ÌååÏïÖÌï¥Ïïº Ìï©ÎãàÎã§.`;
                    tip = 'Í∞ÅÍ∏∞Îë•Ïùò Î©¥Ïùò ÏàòÎäî (Î∞ëÎ©¥Ïùò Î≥ÄÏùò Ïàò + 2), Î™®ÏÑúÎ¶¨Îäî (Î∞ëÎ©¥Ïùò Î≥ÄÏùò Ïàò √ó 3)ÏûÖÎãàÎã§.';
                    break;
                case 'revo_rect':
                case 'revo_semi':
                case 'revo_trapezoid':
                    explanation = `ÌöåÏ†ÑÏ≤¥ Î¨∏Ï†ú ÌíÄÏù¥ÏûÖÎãàÎã§: ÌèâÎ©¥ÎèÑÌòïÏùÑ ÌöåÏ†ÑÏãúÏº∞ÏùÑ Îïå ÎßåÎì§Ïñ¥ÏßÄÎäî ÏûÖÏ≤¥ÎèÑÌòïÏùÑ ÏÉÅÏÉÅÌï¥Ïïº Ìï©ÎãàÎã§.`;
                    tip = 'ÏßÅÏÇ¨Í∞ÅÌòïÏùÄ ÏõêÍ∏∞Îë•, Î∞òÏõêÏùÄ Íµ¨, ÏßÅÍ∞ÅÏÇºÍ∞ÅÌòïÏùÄ ÏõêÎøîÏù¥ Îê©ÎãàÎã§.';
                    break;
                case 'stat_mode':
                case 'stat_median':
                case 'stat_mean':
                    explanation = `ÌÜµÍ≥Ñ Î¨∏Ï†ú ÌíÄÏù¥ÏûÖÎãàÎã§: ÌèâÍ∑†, Ï§ëÏïôÍ∞í, ÏµúÎπàÍ∞í Îì±Ïùò Ïö©Ïñ¥Î•º Ï†ïÌôïÌûà ÏïåÍ≥† Í≥ÑÏÇ∞Ìï¥Ïïº Ìï©ÎãàÎã§.`;
                    tip = 'ÌÜµÍ≥ÑÎäî ÏûêÎ£åÎ•º Ï†ïÌôïÌûà ÏùΩÍ≥† Í∞úÎÖêÏùÑ Ï†ÅÏö©ÌïòÎäî Í≤ÉÏù¥ Ï§ëÏöîÌï©ÎãàÎã§.';
                    break;
                default:
                    explanation = `
                        <div class="explanation-step">Î¨∏Ï†úÎ•º Îã§Ïãú Ìïú Î≤à Ï∞®Í∑ºÏ∞®Í∑º ÏùΩÏñ¥Î≥¥ÏÑ∏Ïöî.</div>
                        <div class="explanation-step">Í≥ÑÏÇ∞ Í≥ºÏ†ïÏùÑ Îã®Í≥ÑÎ≥ÑÎ°ú ÌôïÏù∏Ìï¥Î≥¥ÏÑ∏Ïöî.</div>
                        <div class="explanation-step">ÎπÑÏä∑Ìïú Î¨∏Ï†úÎ•º Îçî ÎßéÏù¥ Ïó∞ÏäµÌï¥Î≥¥ÏÑ∏Ïöî.</div>
                    `;
                    tip = 'Í∏∞Î≥∏ Í∞úÎÖêÏùÑ Îã§Ïãú Ï†ïÎ¶¨ÌïòÍ≥† Ïó∞Ïäµ Î¨∏Ï†úÎ•º ÎßéÏù¥ ÌíÄÏñ¥Î≥¥ÏÑ∏Ïöî.';
            }

            return explanation + `<div class="tip-box">${tip}</div>`;
        }
        
        const userNameInput = document.getElementById('userName');
        const suggestionsDropdown = document.getElementById('suggestionsDropdown');
        
        function saveUserSuggestions() {
            localStorage.setItem('userSuggestions', JSON.stringify(userSuggestions));
        }

        function loadUserSuggestions() {
            const savedSuggestions = localStorage.getItem('userSuggestions');
            if (savedSuggestions) {
                userSuggestions = JSON.parse(savedSuggestions);
            }
        }
        
        function updateSuggestionsDropdown() {
            suggestionsDropdown.innerHTML = '';
            if (userSuggestions.length > 0) {
                suggestionsDropdown.style.display = 'block';
                userSuggestions.forEach(user => {
                    const item = document.createElement('div');
                    item.className = 'suggestion-item';
                    item.innerHTML = `<span class="suggestion-name">${user.name}</span><span class="suggestion-grade">(${user.grade}ÌïôÎÖÑ)</span><button class="delete-btn">x</button>`;
                    item.onclick = (e) => {
                        if (e.target.className === 'delete-btn') {
                            e.stopPropagation();
                            deleteUserSuggestion(user.name);
                        } else {
                            selectUserSuggestion(user);
                        }
                    };
                    suggestionsDropdown.appendChild(item);
                });
            } else {
                suggestionsDropdown.style.display = 'none';
            }
        }

        function selectUserSuggestion(user) {
            userNameInput.value = user.name;
            document.getElementById('grade').value = user.grade;
            updateGradeDisplay();
            suggestionsDropdown.style.display = 'none';
        }

        function deleteUserSuggestion(name) {
            userSuggestions = userSuggestions.filter(user => user.name !== name);
            saveUserSuggestions();
            updateSuggestionsDropdown();
        }

        userNameInput.addEventListener('focus', () => {
            updateSuggestionsDropdown();
        });

        userNameInput.addEventListener('input', () => {
            const filter = userNameInput.value.toLowerCase();
            const filteredSuggestions = userSuggestions.filter(user => user.name.toLowerCase().includes(filter));
            suggestionsDropdown.innerHTML = '';
            if (filteredSuggestions.length > 0 && filter.length > 0) {
                suggestionsDropdown.style.display = 'block';
                filteredSuggestions.forEach(user => {
                    const item = document.createElement('div');
                    item.className = 'suggestion-item';
                    item.innerHTML = `<span class="suggestion-name">${user.name}</span><span class="suggestion-grade">(${user.grade}ÌïôÎÖÑ)</span><button class="delete-btn">x</button>`;
                    item.onclick = (e) => {
                        if (e.target.className === 'delete-btn') {
                            e.stopPropagation();
                            deleteUserSuggestion(user.name);
                        } else {
                            selectUserSuggestion(user);
                        }
                    };
                    suggestionsDropdown.appendChild(item);
                });
            } else {
                suggestionsDropdown.style.display = 'none';
            }
        });

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.name-suggestions')) {
                suggestionsDropdown.style.display = 'none';
            }
        });
        
        function updateGradeDisplay() {
            const gradeSelect = document.getElementById('grade');
            const gradeDisplay = document.getElementById('gradeDisplay');
            const selectedOption = gradeSelect.options[gradeSelect.selectedIndex];
            const optgroupLabel = selectedOption.parentElement.label;
            
            gradeDisplay.textContent = `${optgroupLabel} ${selectedOption.textContent}`;
        }
        
        function saveRecord() {
            const userName = document.getElementById('userName').value.trim() || 'Ïù¥Î¶Ñ ÏóÜÏùå';
            const grade = document.getElementById('grade').value;
            const difficulty = document.getElementById('difficulty').value;
            const problemType = document.getElementById('problemType').value;
            const correctCount = score;
            const totalCount = currentQuiz.length;
            const date = new Date().toLocaleDateString('ko-KR');
            
            const newRecord = {
                userName: userName,
                grade: grade,
                difficulty: difficulty,
                problemType: problemType,
                correct: correctCount,
                wrong: totalCount - correctCount,
                date: date
            };
            records.push(newRecord);
            localStorage.setItem('quizRecords', JSON.stringify(records));
            
            const userExists = userSuggestions.some(user => user.name === userName);
            if (!userExists && userName !== 'Ïù¥Î¶Ñ ÏóÜÏùå') {
                userSuggestions.push({ name: userName, grade: grade });
                saveUserSuggestions();
            }
        }
        
        function showRecords() {
            showSection('recordsView');
            
            const recordsContainer = document.getElementById('recordsContainer');
            const savedRecords = localStorage.getItem('quizRecords');
            
            if (savedRecords) {
                records = JSON.parse(savedRecords);
            }
            
            if (records.length === 0) {
                recordsContainer.innerHTML = '<p>ÏïÑÏßÅ ÌÄ¥Ï¶à Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§.</p>';
                return;
            }
            
            recordsContainer.innerHTML = records.map((record, index) => `
                <div class="record-item">
                    <strong>${record.userName}</strong><br>
                    <small>(${getGradeLabel(record.grade)} / ${record.difficulty} / ${record.problemType})</small><br>
                    Ï†êÏàò: ${record.correct}/${record.correct + record.wrong} Ï†ïÎãµ<br>
                    ÎÇ†Ïßú: ${record.date}
                </div>
            `).join('');
        }
        
        function getGradeLabel(gradeValue) {
            const gradeSelect = document.getElementById('grade');
            const option = gradeSelect.querySelector(`option[value="${gradeValue}"]`);
            if (option) {
                const optgroupLabel = option.parentElement.label;
                return `${optgroupLabel} ${option.textContent}`;
            }
            return 'Ïïå Ïàò ÏóÜÏùå';
        }

        showMainMenu();
        loadUserSuggestions();
        updateGradeDisplay();
    </script>
</body>
</html>